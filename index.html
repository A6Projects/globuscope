<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>globuscope</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Montserrat:wght@600&display=swap" rel="stylesheet">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <style>

:root {
  /* Farben */
  --clr-text:       #2C3E50;
  --clr-accent:     #0066FF;
  --clr-accent-hover: #2980B9;
  --clr-bg:         #F3F5F6;
  --clr-section:    #FFFFFF;
  --clr-border:     #D0D3D4;
  --clr-scroll-thumb: rgba(0, 0, 0, 0.3); /* dunklere Scrollbar */
  --clr-shadow-sm:      rgba(0, 0, 0, 0.05);
  /* Typography */
  --font-body:      'Roboto', sans-serif;
  --font-heading:   'Montserrat', sans-serif;
  --fs-base:        1rem;
  --fs-title:       1.05rem;
  --fs-filter-label: 1.2rem;    /* Schriftgröße für Filterbezeichnungen */
  --fs-filter-text:  0.9rem; /* Schriftgröße für "von... bis...", Span-Infos etc. */
  --lh-base:        1.4;
  --lh-title:       1.2;
  /* Spacing & Radius */
  --spacing-x:      0.75rem;
  --spacing-y:      1.0rem;
  --radius-sm:      0.25rem;
  --radius-md:      0.5rem;
  --shadow-offset:  0 2px 4px var(--clr-shadow-sm);
}



  #cookieBanner {
    position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
    z-index: 1000;
    background: var(--clr-bg);
    border: 1px solid var(--clr-border);
    border-radius: 6px;
    padding: var(--spacing-y) var(--spacing-x);
    display: none; /* wird per JS auf display:flex gesetzt */
    font-family: var(--font-body);
    font-size: var(--fs-base);
    color: var(--clr-text);

    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    max-width: 750px;
    max-hight: 400px
  }

  /* Textblock im Banner */
  #cookieBanner .banner-text {
    flex: 1;
    line-height: 1.4;
  }
  #cookieBanner .banner-text a {
    color: var(--clr-accent);
    text-decoration: underline;
  }

  /* Button-Container */
  #cookieBanner .banner-actions {
    display: flex;
    gap: 0.5rem;
  }

  /* Akzeptieren-Button */
  #cookieBanner button#acceptCookies {
    background: var(--clr-accent);
    color: white;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-family: var(--font-heading);
    font-size: 0.9rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  #cookieBanner button#acceptCookies:hover {
    background: var(--clr-accent-hover);
  }

  /* Ablehnen-Button */
  #cookieBanner button#declineCookies {
    background: transparent;
    color: var(--clr-text);
    border: 1px solid var(--clr-text);
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-family: var(--font-heading);
    font-size: 0.9rem;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
  }
  #cookieBanner button#declineCookies:hover {
    background: var(--clr-border);
    color: var(--clr-text);
  }



/*
/* Innerer Flex-Wrapper: Titel links, Nav rechts */
.map-header-inner {
  max-width: 1200px;      /* optional: zentriert und limitiert */
  margin: 0 auto;         /* zentriert im Viewport */
  display: flex;
  align-items: center;    /* vertikal zentrieren */
/*  justify-content: space-between;  Titel ↔ Nav */
  padding: 1rem;          /* ober-/unterhalb gleichen Abstand */
}
/* Logo beibehalten */
.logo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
/* Navigation im Header */
.main-nav a {
  color: #2C3E50;          /* dunkles Grau für bessere Lesbarkeit */
  text-decoration: none;
  margin-left: 1.5rem;     /* Abstand zwischen Links */
  font-family: var(--font-heading);
  font-size: var(--fs-base);
  font-weight: 500;
  transition: color 0.2s ease;
}
.main-nav a:hover {
  color: rgba(0, 0, 0, 0.5);
  text-decoration: underline;
}



/* Global */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background-color: var(--clr-bg);
  font-family: var(--font-body);
  font-size: var(--fs-base);
  line-height: var(--lh-base);
  color: var(--clr-text);
}


    /* Header */
    .map-header {
      background-color: #E1E4E6;
      border-bottom: 1px solid #AEB5BB;
    }
.map-header-inner {
  margin-left: 1rem; /* verschiebt Inhalt */
  display: flex;
  align-items: center;
}
    .logo-link { text-decoration: none; }
    .logo {
      margin: 0; display: flex; align-items: center;
      font-family: var(--font-heading);
      font-size: 2rem; font-weight: 100;
      color: #2C3E50;
      gap: 0em;
    }
    .globe-icon { margin-left: 0em; display: inline-block; vertical-align: baseline;}
    .globe-icon svg { width: 1em; height: 1em; fill: currentColor; transition: transform .3s ease;}
    .globe-icon:hover svg { transform: rotate(15deg); }
    .main-nav a {
      color: #2C3E50; text-decoration: none;
      margin-left: 1.5rem;
      font-family: var(--font-heading);
      font-weight: 500;
      transition: color .2s ease;
    }
    .main-nav a:hover {
      color: var(--clr-accent-hover);
      text-decoration: underline;
    }

*/

/* ========== Global ========== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background-color: var(--clr-bg);
  font-family: var(--font-body);
  font-size: var(--fs-base);
  line-height: var(--lh-base);
  color: var(--clr-text);
}


/* ========== Header ========== */
.map-header {
  background-color: #E1E4E6;
  border-bottom: 1px solid #AEB5BB;
}

/* Innerer Flex-Wrapper: Titel links, Nav rechts */
.map-header-inner {
//  max-width: 1200px;         /* optional: begrenzte Breite */
  margin-left: 1rem;
  padding: 0.5rem;             /* vertikaler Abstand */
  display: flex;
  align-items: center;       /* vertikal zentriert */
  gap: 2rem;
//  justify-content: space-between; /* Logo links – Nav rechts */
}


/* ========== Logo + Titel ========== */
.logo-link {
  text-decoration: none;
}

.logo {
  display: flex;
  align-items: center;
  gap: 0.05rem;
  margin: 0;
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 100;
  color: #2C3E50;
}

.globe-icon {
  display: inline-block;
  vertical-align: baseline;
}

.globe-icon svg {
  width: 1em;
  height: 1em;
  fill: currentColor;
  transition: transform 0.3s ease;
}

.globe-icon:hover svg {
  transform: rotate(15deg);
}


/* ========== Navigation ========== */
.main-nav a {
  color: #2C3E50;
  text-decoration: none;
  margin-left: 1.5rem;
  font-family: var(--font-heading);
  font-size: var(--fs-base);
  font-weight: 500;
  transition: color 0.2s ease;
}

.main-nav a:hover {
  color: rgba(0, 0, 0, 0.5);
  text-decoration: underline;
}


#container {
  flex: 1;
  display: flex;
  min-height: 0;
}

/* Filter-Sektion */
#filters {
  display: flex;
  gap: 1em;
  padding: var(--spacing-y) var(--spacing-x);
  background: var(--clr-bg);
  border-bottom: 1px solid var(--clr-border);
  min-height: 0;
}
.filters-list {
  flex: 0 0 300px;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow-y: auto;
  gap: var(--spacing-y);
  padding-right: 12px; /* Damit Inhalt Abstand von der Scrollbar hat */
}
/* Optional: Scrollbar-Style (Webkit) */
.filters-list::-webkit-scrollbar {
  width: 8px;
  color: var(--clr-scroll-thumb);


}
.filters-list::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.3);
  border-radius: 4px;
}

/* Filter-Abschnitte (erweiterbar/einklappbar) */
.filter-section {
  background-color: var(--clr-section);
  padding: var(--spacing-y) var(--spacing-x);
  box-shadow: var(--shadow-offset);
}
.filter-section + .filter-section {
  margin-top: 0.5rem
}
.filter-section-title {
  display: inline-flex;
  align-items: center;
  font-family: var(--font-heading);
  font-size: var(--fs-title);
  line-height: var(--lh-title);
  font-weight: 600;
  color: var(--clr-text);
  text-transform: capitalize;
  letter-spacing: 0.03em;
  margin: 0;
  background-color: var(--clr-bg);
  padding: 0.6rem var(--spacing-x);
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  border-bottom: 3px solid var(--clr-accent);
  cursor: pointer;
  user-select: none;
  position: relative;
}
.filter-section-title::before {
  content: '▾';
  display: inline-block;
  margin-right: 0.5em;
  font-size: 0.9em;
  transition: transform 0.2s ease;
}
.filter-section.collapsed .filter-section-content {
  max-height: 0;
  margin-top: 0;
  overflow: hidden;
}
.filter-section-content {
  margin-top: 1.2rem;
  transition: max-height 0.3s ease;
  max-height: 1000px;
}
.filter-section.collapsed .filter-section-title::before {
  transform: rotate(-90deg);
}
.filter-section-title:hover {
  background-color: #EDEFF1;
  border-bottom-color: var(--clr-accent-hover);
}
.filter-group {
  margin-bottom: 0.4rem; /* mehr Abstand zu nächsten Filter */
  padding: 0.5rem; /* abgehobener Bereich */
  background-color: #FFFFFF; /* etwas Kontrast zur Sektion */
}
.filter-group label {
  display: block;
  font-size: 1.0em;
  margin-bottom: 0.25rem;
  font-weight: 500;
}
.filter-group input[type="range"] {
  width: 100%;
}
.filter-group span {
  font-size: 0.9em;
}

.filter-section .filter-group:not(:last-of-type) > span:last-of-type {
  display: block;
  margin-top: 0rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--clr-border); /* oder rgba(0, 0, 0, 0.2) für dezent */
}


.lang-list {
  max-height: 160px;      /* gewünschte Höhe */
  overflow-y: auto;       /* vertikales Scrollen */
  border: 1px solid #ccc; /* optional: Rahmen */
  padding: 4px;           /* etwas Innenabstand */
  background: #fff;       /* weißer Hintergrund */
  border-radius: 4px;
}
.lang-list::-webkit-scrollbar {
  width: 6px;
}
.lang-list::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.3);
  border-radius: 4px;
}


/* Info-Icon */
.info-icon {
  display: inline-block;
  margin-left: 0px;
  cursor: pointer;
  font-weight: bold;
  color: var(--clr-accent);
  font-size: 1.0em;
}

/* Definitions-Panel */
#filterDefinitionPanel {
  flex: 0 0 400px;
  padding: var(--spacing-y) var(--spacing-x);
  background: var(--clr-section);
  overflow-y: auto;
  overflow-x: hidden;
  font-size: 0.9em;
  line-height: var(--lh-base);
  display: none;
  box-shadow: var(--shadow-offset);
  word-wrap: break-word;         /* für ältere Browser */
  overflow-wrap: break-word;     /* Standard: bricht lange Wörter */
  white-space: normal;           /* erlaubt Umbrüche in normalem Fließtext */
}
#filterDefinitionPanel::-webkit-scrollbar {
  width: 6px;
}
#filterDefinitionPanel::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.3);
  border-radius: 4px;
}
#filterDefinitionPanel.visible {
  display: block;
}
#filterDefinitionPanel h1 {
  font-family: var(--font-heading);
  font-size: 1.2em;
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--clr-text);
}
#filterDefinitionPanel h2 {
  font-family: var(--font-heading);
  font-size: 1em;
  font-weight: 500;
  margin-top: 1em;
  color: var(--clr-text);
}
#filterDefinitionPanel a {
  color: var(--clr-accent);
  text-decoration: underline;
  margin: 0.5em 0;
}
/* Stichpunkte */
#filterDefinitionPanel ul {
  margin: 0.5em 0;
  padding-left: 1.2em;
}

/* Map-Container */
#map {
  flex: 1;
  min-height: 0;
  background-color: var(--clr-bg);
}

/* Leaflet-Popup: moderner Look */
.leaflet-popup-content-wrapper {
  border-radius: 5px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.leaflet-popup-content {
  font-family: var(--font-body);
  font-size: var(--fs-base);
  color: var(--clr-text);
  padding: var(--spacing-y) var(--spacing-x);
}
.leaflet-popup-content h3 {
  font-family: var(--font-heading);
  font-size: 1.1em;
  margin: 0 0 1em 0;
  color: var(--clr-text);
}
.leaflet-popup-content {
  max-height: 700px; /* oder deine Wunschhöhe */
  overflow-y: auto;
  overflow-x: hidden;

  /* notwendig für Scrollbar-Styling */
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
}

/* Scrollbar-Styling für Leaflet-Popup-Content */
.leaflet-popup-content::-webkit-scrollbar {
  width: 6px;
}

.leaflet-popup-content::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.3);
  border-radius: 4px;
}

.leaflet-popup-content table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 0.5em;
}
.leaflet-popup-content th,
.leaflet-popup-content td {
  padding: 4px;
  border-bottom: 1px solid var(--clr-border);
  text-align: left;
  vertical-align: top;
  font-size: 0.9em;
}
.leaflet-popup-content .section-header td {
  background-color: #EDEFF1;
  font-weight: 600;
}



.leaflet-popup-content {
  position: relative; /* wichtig für absolutes Positionieren */
}

.leaflet-popup-content .compare-btn {
  position: absolute;
  top: 0.5rem;
  padding-bottom: 1rem;
  right: 0.5rem;

  padding: 6px 12px;
  background: var(--clr-accent);
  color: #fff;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 0.9em;
  z-index: 10; /* über allem anderen */
}

.leaflet-popup-content .compare-btn:hover {
  background: var(--clr-accent-hover);
}

/* Compare-Panel: moderner Look */
.compare-panel {
  flex: 0 0 500px;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: auto;
  background: var(--clr-section);

  padding: var(--spacing-y) var(--spacing-x);
  font-size: 0.9em;
  z-index: 10;
  box-shadow: var(--shadow-offset);
}
.compare-panel::-webkit-scrollbar {
  width: 8px;
}
.compare-panel::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.2);
  border-radius: 4px;
}


#comparePanel h3 {
  font-family: var(--font-heading);
  font-size: 1.3em;
  margin: 0 0 1em 0;
}
#compareTable {
  width: 100%;
  border-collapse: collapse;
}
#compareTable th,
#compareTable td {
  border-bottom: 1px solid var(--clr-border);
  padding: 6px 4px;
  text-align: left;
  vertical-align: top;
}
#compareTable .section-header td {
  background-color: #EDEFF1;
  font-weight: 600;
}

/* Slider-Thumbs (bleibt blau) */
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  background: var(--clr-accent);
  border: none;
  height: 16px;
  width: 16px;
  border-radius: 50%;
  cursor: pointer;
  position: relative;
  z-index: 3;
}
input[type=range]::-moz-range-thumb {
  background: var(--clr-accent);
  border: none;
  height: 16px;
  width: 16px;
  border-radius: 50%;
  cursor: pointer;
  position: relative;
  z-index: 3;
}

/* Vergleichs-Button im Popup */
.leaflet-popup-content .compare-btn {
  margin-top: 8px;
  padding: 6px 12px;
  background: var(--clr-accent);
  color: #0066FF;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 0.8em;
  right: 2rem;
}
.leaflet-popup-content .compare-btn:hover {
  background: var(--clr-accent-hover);
}

/* Infopanel Scrollbar optional */
#compareTable tbody {
  max-height: 400px;
  overflow-y: auto;
}



/* Speziell für den #area-Dual-Slider */
#areaFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#areaFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#areaFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#areaFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#areaFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#areaFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#areaFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#areaFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #forest-Dual-Slider */
#forestFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#forestFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#forestFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#forestFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#forestFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#forestFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#forestFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#forestFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}



    /* Speziell für den Temperatur‐Dual‐Slider */
    #tempFilterContainer {
      position: relative;
      height: 30px;
      margin-bottom: 4px;
    }
    #tempFilterContainer input[type=range] {
      position: absolute;
      width: 100%;
      height: 30px;
      margin:0; padding:0;
      -webkit-appearance: none;
      background: none;
      pointer-events: none;
    }
    #tempFilterContainer input[type=range]::-webkit-slider-thumb {
      pointer-events: all;
    }
    #tempFilterContainer input[type=range]::-moz-range-thumb {
      pointer-events: all;
    }
    #tempFilterContainer .slider-track {
      position: absolute; top:12px; width:100%; height:6px;
      background:#ccc; border-radius:3px; z-index:1;
    }
    #tempFilterContainer .slider-range {
      position: absolute; top:12px; height:6px;
      background:#0066FF; border-radius:3px; z-index:2;
      left:0; width:0;
    }
#tempFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#tempFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


 /* Speziell für den Niederschlag‐Dual‐Slider */
    #precipFilterContainer {
      position: relative;
      height: 30px;
      margin-bottom: 4px;
    }
    #precipFilterContainer input[type=range] {
      position: absolute;
      width: 100%;
      height: 30px;
      margin:0; padding:0;
      -webkit-appearance: none;
      background: none;
      pointer-events: none;
    }
    #precipFilterContainer input[type=range]::-webkit-slider-thumb {
      pointer-events: all;
    }
    #precipFilterContainer input[type=range]::-moz-range-thumb {
      pointer-events: all;
    }
    #precipFilterContainer .slider-track {
      position: absolute; top:12px; width:100%; height:6px;
      background:#ccc; border-radius:3px; z-index:1;
    }
    #precipFilterContainer .slider-range {
      position: absolute; top:12px; height:6px;
      background:#0066FF; border-radius:3px; z-index:2;
      left:0; width:0;
    }

#precipFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#precipFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


 /* Speziell für den Regentage-Dual-Slider */
    #rainyFilterContainer {
      position: relative;
      height: 30px;
      margin-bottom: 4px;
    }
    #rainyFilterContainer input[type=range] {
      position: absolute;
      width: 100%;
      height: 30px;
      margin:0; padding:0;
      -webkit-appearance: none;
      background: none;
      pointer-events: none;
    }
    #rainyFilterContainer input[type=range]::-webkit-slider-thumb {
      pointer-events: all;
    }
    #prainyFilterContainer input[type=range]::-moz-range-thumb {
      pointer-events: all;
    }
    #rainyFilterContainer .slider-track {
      position: absolute; top:12px; width:100%; height:6px;
      background:#ccc; border-radius:3px; z-index:1;
    }
    #rainyFilterContainer .slider-range {
      position: absolute; top:12px; height:6px;
      background:#0066FF; border-radius:3px; z-index:2;
      left:0; width:0;
    }

#rainyFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#rainyFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}

   #resetBtn {
      font-size: 0.8rem;
      margin-bottom: 10px;
      align-self: flex-start;
      padding: 6px 12px;
      background: #2196F3;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      top: 0;
      z-index: 10;
    }


/* Speziell für den Sonnenstunden-Dual-Slider */
    #sunFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
    #sunFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
    #sunFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
    #sunFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
    #sunFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
    #sunFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#sunFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#sunFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den Bevölkerungs-Dual-Slider */
    #popFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
    #popFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
    #popFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
    #popFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
    #popFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
    #popFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#popFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#popFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #dens-Dual-Slider */
#densFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#densFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#densFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#densFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#densFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#densFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#densFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#densFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #hdi-Dual-Slider */
#hdiFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#hdiFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#hdiFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#hdiFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#hdiFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#hdiFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#hdiFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#hdiFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #life-Dual-Slider */
#lifeFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#lifeFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#lifeFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#lifeFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#lifeFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#lifeFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#lifeFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#lifeFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #health-Dual-Slider */
#healthFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#healthFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#healthFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#healthFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#healthFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#healthFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#healthFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#healthFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #pisa-Dual-Slider */
#pisaFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#pisaFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#pisaFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#pisaFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#pisaFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#pisaFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#pisaFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#pisaFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #risk-Dual-Slider */
#riskFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#riskFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#riskFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#riskFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#riskFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#riskFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#riskFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#riskFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #conf-Dual-Slider */
#confFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#confFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#confFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#confFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#confFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#confFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#confFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#confFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #vuln-Dual-Slider */
#vulnFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#vulnFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#vulnFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#vulnFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#vulnFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#vulnFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#vulnFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#vulnFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #homicide-Dual-Slider */
#homicideFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#homicideFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#homicideFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#homicideFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#homicideFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#homicideFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#homicideFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#homicideFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #gdp-Dual-Slider */
#gdpFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#gdpFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#gdpFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#gdpFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#gdpFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#gdpFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#gdpFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#gdpFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}


/* Speziell für den #taxRate-Dual-Slider */
#taxRateFilterContainer {position: relative; height: 30px; margin-bottom: 4px;}
#taxRateFilterContainer input[type=range] {position: absolute; width: 100%; height: 30px; margin:0; padding:0; -webkit-appearance: none; background: none; pointer-events: none;}
#taxRateFilterContainer input[type=range]::-webkit-slider-thumb {pointer-events: all;}
#taxRateFilterContainer input[type=range]::-moz-range-thumb {pointer-events: all;}
#taxRateFilterContainer .slider-track {position: absolute; top:12px; width:100%; height:6px; background:#ccc; border-radius:3px; z-index:1;}
#taxRateFilterContainer .slider-range {position: absolute; top:12px; height:6px; background:#0066FF; border-radius:3px; z-index:2; left:0; width:0;}
#taxRateFilterContainer .slider-mark { position: absolute; top: 50%; transform: translateY(-87%); width: 0; height: 22px; border-left: 2px solid black; pointer-events: none; z-index: 4; }
#taxRateFilterContainer .marker-label { position: absolute; top: -0.55em; transform: translateY(-6%) translateX(8%); font-size: 0.85em; color: black; white-space: nowrap; pointer-events: none; z-index: 5;}




  </style>
</head>
<body>



<div class="map-header">
  <div class="map-header-inner">
      <a href="index.html" class="logo-link">
<h1 class="logo">
  globuscope<span class="globe-icon" aria-hidden="true">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="293.000000pt" height="292.000000pt" viewBox="0 0 293.000000 292.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,292.000000) scale(0.100000,-0.100000)"
fill="currentColor" stroke="none">
<path d="M1276 2794 c-283 -44 -515 -157 -714 -348 -197 -189 -329 -430 -389
-709 -26 -117 -25 -408 1 -527 69 -321 252 -606 511 -796 383 -282 926 -335
1363 -133 252 116 493 351 620 605 41 82 96 241 118 344 26 121 26 401 0 520
-56 257 -168 469 -341 649 -294 305 -753 460 -1169 395z m4 -199 c0 -2 -23
-16 -50 -30 -70 -35 -130 -92 -130 -121 0 -23 3 -24 63 -24 70 0 72 1 110 53
32 43 42 46 50 15 17 -63 -18 -90 -151 -119 -45 -10 -103 -27 -128 -39 -25
-11 -50 -17 -55 -14 -5 3 -9 23 -9 45 0 23 -5 39 -12 39 -20 0 -76 -49 -83
-72 -4 -13 -17 -34 -29 -47 l-21 -24 26 6 c33 8 63 -12 53 -36 -3 -9 -10 -17
-15 -17 -5 0 -9 -18 -9 -40 l0 -40 -54 0 c-65 0 -75 -10 -83 -84 -6 -59 -5
-60 42 -57 50 4 66 13 85 52 17 33 33 46 87 71 79 37 100 38 178 7 57 -23 60
-26 60 -58 0 -43 15 -48 45 -16 l25 26 -50 44 c-28 24 -47 46 -44 49 11 11
107 -26 129 -49 12 -13 23 -35 24 -50 5 -39 18 -47 83 -51 32 -2 92 -9 133
-16 71 -12 75 -15 78 -40 2 -19 -5 -36 -23 -54 -25 -25 -31 -26 -88 -20 -199
21 -185 21 -221 -13 l-32 -31 -39 20 c-22 11 -46 20 -55 20 -26 0 -40 22 -40
61 0 41 -11 49 -64 49 -42 0 -273 -67 -311 -90 -51 -31 -214 -205 -231 -246
-21 -50 -20 -177 1 -251 17 -59 75 -130 149 -185 50 -36 102 -37 174 -3 65 30
103 31 161 5 24 -11 53 -20 66 -20 21 0 22 -3 17 -69 l-5 -69 62 -66 c33 -36
61 -72 61 -79 0 -7 -7 -37 -16 -67 -9 -31 -13 -67 -9 -86 6 -36 123 -219 174
-273 29 -31 35 -33 74 -27 64 10 160 61 205 110 39 42 62 95 62 143 0 14 15
34 39 54 65 52 70 80 45 270 l-6 45 92 74 c51 41 106 92 122 114 28 40 65 142
54 153 -3 3 -33 -6 -66 -21 -75 -32 -84 -32 -103 -3 -8 12 -39 47 -69 78 -54
56 -178 260 -178 292 0 45 38 4 134 -141 57 -88 111 -162 120 -165 23 -9 60 0
116 28 136 68 216 188 144 216 -15 5 -44 9 -65 7 -21 -1 -40 0 -41 3 -2 2 -27
32 -56 66 -28 34 -52 64 -52 67 0 17 34 2 69 -29 32 -29 53 -38 132 -54 52
-10 107 -19 124 -19 16 0 31 -4 32 -9 2 -6 17 -31 33 -56 21 -33 34 -44 47
-41 15 4 24 -13 55 -113 21 -65 40 -128 44 -141 3 -15 12 -22 22 -20 20 4 40
84 41 165 1 54 41 163 60 163 31 0 45 -276 22 -410 -25 -143 -97 -317 -184
-445 -53 -78 -185 -214 -267 -276 -82 -62 -233 -140 -336 -174 -87 -29 -253
-54 -353 -55 -35 0 -109 7 -164 16 -367 58 -685 287 -845 609 -174 350 -158
764 43 1100 118 198 284 349 490 446 108 51 285 103 285 84z m396 -446 c14
-15 15 -22 6 -28 -14 -8 -209 -8 -217 1 -17 17 73 45 151 47 30 1 46 -5 60
-20z"/>
<path d="M1965 901 c-3 -11 -26 -37 -50 -56 -50 -41 -64 -71 -67 -139 -3 -45
-1 -50 25 -58 37 -13 50 -1 94 86 27 54 36 84 37 126 1 43 -2 55 -16 58 -10 2
-19 -5 -23 -17z"/>
</g>
</svg>
  </span>
</h1>
</a>

    <nav class="main-nav">
      <a href="Impressum_.html">Impressum</a>
      <a href="datenschutz_1.html">Datenschutz</a>
    </nav>
  </div>
</div>
  <div id="container">
    <div id="filters">

<div class="filters-list">

  <button id="resetBtn">Zurücksetzen</button>




  <div class="filter-section" id="section-sprache">
    <div class="filter-section-title">Sprache</div>
    <div class="filter-section-content">

<div class="filter-group">


  <!-- neuer scrollbarer Container -->
  <div class="lang-list">


    <label><input type="checkbox" id="langAl" /> Albanisch</label>
    <label><input type="checkbox" id="langAr" /> Arabisch</label>
    <label><input type="checkbox" id="langArm" /> Armenisch</label>
    <label><input type="checkbox" id="langBu" /> Bulgarisch</label>
    <label><input type="checkbox" id="langDe" /> Deutsch</label>
    <label><input type="checkbox" id="langEn" /> Englisch</label>
    <label><input type="checkbox" id="langFr" /> Französisch</label>
    <label><input type="checkbox" id="langGr" /> Griechisch</label>
    <label><input type="checkbox" id="langHi" /> Hindi</label>
    <label><input type="checkbox" id="langIt" /> Italienisch</label>
    <label><input type="checkbox" id="langKo" /> Koreanisch</label>
    <label><input type="checkbox" id="langKr" /> Kroatisch</label>
    <label><input type="checkbox" id="langCh" /> Mandarin</label>
    <label><input type="checkbox" id="langNi" /> Niederländisch</label>
    <label><input type="checkbox" id="langPe" /> Persisch</label>
    <label><input type="checkbox" id="langPol" /> Polnisch</label>
    <label><input type="checkbox" id="langPo" /> Portugiesisch</label>
    <label><input type="checkbox" id="langQu" /> Quechua</label>
    <label><input type="checkbox" id="langRum" /> Rumänisch</label>
    <label><input type="checkbox" id="langRu" /> Russisch</label>
    <label><input type="checkbox" id="langSe" /> Serbisch</label>
    <label><input type="checkbox" id="langSl" /> Slowakisch</label>
    <label><input type="checkbox" id="langSlo" /> Slowenisch</label>
    <label><input type="checkbox" id="langSp" /> Spanisch</label>
    <label><input type="checkbox" id="langSw" /> Swahili</label>
    <label><input type="checkbox" id="langTr" /> Türkisch</label>
    <label><input type="checkbox" id="langUk" /> Ukrainisch</label>
    <label><input type="checkbox" id="langUn" /> Ungarisch</label>
    <label><input type="checkbox" id="langWe" /> Weißrussisch</label>


    <!-- ggf. später weitere Sprachen hier hinzufügen -->
  </div>
  <!-- darunter weiterhin die Zusatz-Checkboxen -->
  <div style="margin-top:8px; display:flex; flex-direction:column; gap:4px; padding-left:8px;">
    <label><input type="checkbox" id="langNA" /> N/A als Amtssprache zulassen</label>
    <label><input type="checkbox" id="langRegional" /> Regionale Sprachen berücksichtigen</label>
  </div>
</div>
</div>
</div>



<div class="filter-section" id="section-klima">
    <div class="filter-section-title">Klima</div>
     <div class="filter-section-content">



      <div class="filter-group"><label>
<span class="info-icon" data-definition="Jt">ⓘ</span>
Durchschnittstemperatur</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="tempIncludeNA" checked style="margin-right:6px;">
  <label for="tempIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
        <div id="tempFilterContainer">
         <div class="slider-track"></div>
          <div class="slider-range" id="tempSliderRange"></div>

<div class="slider-mark" style="left: calc((18.2 - -55) / (32 - -55) * 100%);"></div>
<div class="marker-label" style="left: calc((18.2 - -55) / (32 - -55) * 100%);">Median</div>

          <input type="range" id="tempFilterMin" min="-55" max="32" step="1" value="-55">
          <input type="range" id="tempFilterMax" min="-55" max="32" step="1" value="32">
        </div>
        <span>
          <small>von</small> <span id="tempMinValue">-55</span>
          <small>bis</small> <span id="tempMaxValue">32</span><small> °C</small>
        </span>
      </div>

      <div class="filter-group"><label>
<span class="info-icon" data-definition="Ns">ⓘ</span>
Niederschlag</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="precipIncludeNA" checked style="margin-right:6px;">
  <label for="precipIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="precipFilterContainer">
        <div class="slider-track"></div>
          <div class="slider-range" id="precipSliderRange"></div>

<div class="slider-mark" style="left: calc((799 - 0) / (10000 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((799 - 0) / (10000 - 0) * 100%);">Median</div>

          <input type="range" id="precipFilterMin" min="0" max="10000" step="50" value="0">
          <input type="range" id="precipFilterMax" min="0" max="10000" step="50" value="10000">
        </div>
        <span>
          <small>von</small> <span id="precipMinValue">0</span>
          <small>bis</small> <span id="precipMaxValue">9200</span><small> mm/Jahr</small>
        </span>
      </div>

      <div class="filter-group"><label>
<span class="info-icon" data-definition="Rt">ⓘ</span>
Regentage</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="rainyIncludeNA" checked style="margin-right:6px;">
  <label for="rainyIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="rainyFilterContainer">
        <div class="slider-track"></div>
          <div class="slider-range" id="rainySliderRange"></div>

<div class="slider-mark" style="left: calc((86.5 - 0) / (300 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((86.5 - 0) / (300 - 0) * 100%);">Median</div>

          <input type="range" id="rainyFilterMin" min="0" max="300" step="5" value="0">
          <input type="range" id="rainyFilterMax" min="0" max="300" step="5" value="300">
        </div>
        <span>
          <small>von</small> <span id="rainyMinValue">0</span>
          <small>bis</small> <span id="rainyMaxValue">290</span><small> d/Jahr</small>
        </span>
      </div>


      <div class="filter-group"><label>
<span class="info-icon" data-definition="Ss">ⓘ</span>
Sonnenstunden</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="sunIncludeNA" checked style="margin-right:6px;">
  <label for="sunIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="sunFilterContainer"><div class="slider-track"></div>
          <div class="slider-range" id="sunSliderRange"></div>

<div class="slider-mark" style="left: calc((2266 - 400) / (4000 - 400) * 100%);"></div>
<div class="marker-label" style="left: calc((2266 - 400) / (4000 - 400) * 100%);">Median</div>

          <input type="range" id="sunFilterMin" min="400" max="4000" step="100" value="400">
          <input type="range" id="sunFilterMax" min="400" max="4000" step="100" value="4000"></div><span>
          <small>von</small> <span id="sunMinValue">400</span>
          <small>bis</small> <span id="sunMaxValue">3800</span><small> h/Jahr</small></span></div>

</div>
</div>







  <div class="filter-section" id="section-risiko">
    <div class="filter-section-title">Risiko & Sicherheit</div>
     <div class="filter-section-content">


<div class="filter-group"><label>
<span class="info-icon" data-definition="N">ⓘ</span>
Natur- und Gesundheitskatastrophen</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="riskIncludeNA" checked style="margin-right:6px;">
  <label for="riskIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="riskFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="riskSliderRange"></div>

<div class="slider-mark" style="left: calc((3.8 - 0) / (10 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((3.8 - 0) / (10 - 0) * 100%);">Median</div>

        <input type="range" id="riskFilterMin" min="0" max="10" step="0.1" value="0">
        <input type="range" id="riskFilterMax" min="0" max="10" step="0.1" value="10"></div><span>
        <small>von</small> <span id="riskMinValue">0.9</span>
        <small>bis</small> <span id="riskMaxValue">8.3</span><small> [-]</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="Kr">ⓘ</span>
Konfliktintensität und -wahrscheinlichkeit</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="confIncludeNA" checked style="margin-right:6px;">
  <label for="confIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="confFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="confSliderRange"></div>

<div class="slider-mark" style="left: calc((0.1 - 0) / (10 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((0.1 - 0) / (10 - 0) * 100%);">Median</div>

        <input type="range" id="confFilterMin" min="0" max="10" step="0.1" value="0">
        <input type="range" id="confFilterMax" min="0" max="10" step="0.1" value="10"></div><span>
        <small>von</small> <span id="confMinValue">0.1</span>
        <small>bis</small> <span id="confMaxValue">10</span><small> [-]</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="V">ⓘ</span>
Vulnerabilität</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="vulnIncludeNA" checked style="margin-right:6px;">
  <label for="vulnIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="vulnFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="vulnSliderRange"></div>

<div class="slider-mark" style="left: calc((3.9 - 0) / (10 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((3.9 - 0) / (10 - 0) * 100%);">Median</div>

        <input type="range" id="vulnFilterMin" min="0" max="10" step="0.1" value="0">
        <input type="range" id="vulnFilterMax" min="0" max="10" step="0.1" value="10"></div><span>
        <small>von</small> <span id="vulnMinValue">0.5</span>
        <small>bis</small> <span id="vulnMaxValue">9.3</span><small> [-]</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="M">ⓘ</span>
Mordrate</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="homicideIncludeNA" checked style="margin-right:6px;">
  <label for="homicideIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="homicideFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="homicideSliderRange"></div>

<div class="slider-mark" style="left: calc((4.55 - 0) / (100 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((4.55 - 0) / (100 - 0) * 100%);">Median</div>

        <input type="range" id="homicideFilterMin" min="0" max="100" step="1" value="0">
        <input type="range" id="homicideFilterMax" min="0" max="100" step="1" value="100"></div><span>
        <small>von</small> <span id="homicideMinValue">0.2</span>
        <small>bis</small> <span id="homicideMaxValue">93.8</span><small> je 100.000 Einwohner</small></span></div>

</div>
</div>

  <div class="filter-section" id="section-wirtschaft">
    <div class="filter-section-title">Wirtschaft</div>
     <div class="filter-section-content">

<div class="filter-group"><label>
<span class="info-icon" data-definition="BIP">ⓘ</span>
BIP</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="gdpIncludeNA" checked style="margin-right:6px;">
  <label for="gdpIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="gdpFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="gdpSliderRange"></div>

<div class="slider-mark" style="left: calc((5398 - 0) / (140000 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((5398 - 0) / (140000 - 0) * 100%);">Median</div>

        <input type="range" id="gdpFilterMin" min="0" max="140000" step="500" value="0">
        <input type="range" id="gdpFilterMax" min="0" max="140000" step="500" value="140000"></div><span>
        <small>von</small> <span id="gdpMinValue">272</span>
        <small>bis</small> <span id="gdpMaxValue">136701</span><small> USD/Einwohner</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="Sq">ⓘ</span>
Steuerquote</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="taxRateIncludeNA" checked style="margin-right:6px;">
  <label for="taxRateIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="taxRateFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="taxRateSliderRange"></div>

<div class="slider-mark" style="left: calc((19.85 - 0) / (50 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((19.85 - 0) / (50 - 0) * 100%);">Median</div>

        <input type="range" id="taxRateFilterMin" min="0" max="50" step="1" value="0">
        <input type="range" id="taxRateFilterMax" min="0" max="50" step="1" value="50"></div><span>
        <small>von</small> <span id="taxRateMinValue">2.2</span>
        <small>bis</small> <span id="taxRateMaxValue">48</span><small> %</small></span></div>

</div>
</div>





  <div class="filter-section" id="section-entwicklung">
    <div class="filter-section-title">Entwicklung</div>
     <div class="filter-section-content">


<div class="filter-group"><label>
<span class="info-icon" data-definition="HDI">ⓘ</span>
HDI</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="hdiIncludeNA" checked style="margin-right:6px;">
  <label for="hdiIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="hdiFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="hdiSliderRange"></div>

<div class="slider-mark" style="left: calc((0.74 - 0.35) / (1 - 0.35) * 100%);"></div>
<div class="marker-label" style="left: calc((0.74 - 0.35) / (1 - 0.35) * 100%);">Median</div>

        <input type="range" id="hdiFilterMin" min="0.35" max="1" step="0.01" value="0.35">
        <input type="range" id="hdiFilterMax" min="0.35" max="1" step="0.01" value="1"></div><span>
        <small>von</small> <span id="hdiMinValue">0.38</span>
        <small>bis</small> <span id="hdiMaxValue">0.97</span><small> [-]</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="Le">ⓘ</span>
Lebenserwartung</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="lifeIncludeNA" checked style="margin-right:6px;">
  <label for="lifeIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="lifeFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="lifeSliderRange"></div>

<div class="slider-mark" style="left: calc((72.3 - 50) / (90 - 50) * 100%);"></div>
<div class="marker-label" style="left: calc((72.3 - 50) / (90 - 50) * 100%);">Median</div>

        <input type="range" id="lifeFilterMin" min="50" max="90" step="1" value="50">
        <input type="range" id="lifeFilterMax" min="50" max="90" step="1" value="90"></div><span>
        <small>von</small> <span id="lifeMinValue">53</span>
        <small>bis</small> <span id="lifeMaxValue">86.9</span><small> Jahre</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="Gv">ⓘ</span>
Gesundheitsversorgung</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="healthIncludeNA" checked style="margin-right:6px;">
  <label for="healthIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="healthFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="healthSliderRange"></div>

<div class="slider-mark" style="left: calc((4 - 0) / (10 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((4 - 0) / (10 - 0) * 100%);">Median</div>

        <input type="range" id="healthFilterMin" min="0" max="10" step="0.1" value="0">
        <input type="range" id="healthFilterMax" min="0" max="10" step="0.1" value="10"></div><span>
        <small>von</small> <span id="healthMinValue">0.1</span>
        <small>bis</small> <span id="healthMaxValue">9.7</span><small> [-]</small></span></div>

<div class="filter-group"><label>
<span class="info-icon" data-definition="PISA">ⓘ</span>
PISA-Studie</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="pisaIncludeNA" checked style="margin-right:6px;">
  <label for="pisaIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="pisaFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="pisaSliderRange"></div>

<div class="slider-mark" style="left: calc((438 - 300) / (600 - 300) * 100%);"></div>
<div class="marker-label" style="left: calc((438 - 300) / (600 - 300) * 100%);">Median</div>

        <input type="range" id="pisaFilterMin" min="300" max="600" step="1" value="300">
        <input type="range" id="pisaFilterMax" min="300" max="600" step="1" value="600"></div><span>
        <small>von</small> <span id="pisaMinValue">337</span>
        <small>bis</small> <span id="pisaMaxValue">560</span><small> Punkte</small></span></div>

</div>
</div>




  <div class="filter-section" id="section-geographie">
    <div class="filter-section-title">Geographie</div>
    <div class="filter-section-content">

      <div class="filter-group"><label>
<span class="info-icon" data-definition="Lf">ⓘ</span>
Landfläche</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="areaIncludeNA" checked style="margin-right:6px;">
  <label for="areaIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="areaFilterContainer"><div class="slider-track"></div>
          <div class="slider-range" id="areaSliderRange"></div>

<div class="slider-mark" style="left: calc((120410 - 0) / (16400000 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((120410 - 0) / (16400000 - 0) * 100%);">Median</div>


          <input type="range" id="areaFilterMin" min="0" max="16400000" step="1000" value="0">
          <input type="range" id="areaFilterMax" min="0"" max="16400000" step="1000" value="16400000"></div><span>
          <small>von</small> <span id="areaMinValue">0</span>
          <small>bis</small> <span id="areaMaxValue">16400000</span><small> km²</small></span></div>

      <div class="filter-group"><label>
<span class="info-icon" data-definition="Wf">ⓘ</span>
Waldfläche</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="forestIncludeNA" checked style="margin-right:6px;">
  <label for="forestIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="forestFilterContainer"><div class="slider-track"></div>
          <div class="slider-range" id="forestSliderRange"></div>

<div class="slider-mark" style="left: calc((31.2 - 0) / (100 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((31.2 - 0) / (100 - 0) * 100%);">Median</div>

          <input type="range" id="forestFilterMin" min="0" max="100" step="1" value="0">
          <input type="range" id="forestFilterMax" min="0" max="100" step="1" value="100"></div><span>
          <small>von</small> <span id="forestMinValue">0</span>
          <small>bis</small> <span id="forestMaxValue">100</span><small> %</small></span></div>

      <div class="filter-group"><label>
<span class="info-icon" data-definition="B">ⓘ</span>
Bevölkerung</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="popIncludeNA" checked style="margin-right:6px;">
  <label for="popIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
       <div id="popFilterContainer"><div class="slider-track"></div>
          <div class="slider-range" id="popSliderRange"></div>

<div class="slider-mark" style="left: calc((9119 - 0) / (280000 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((9119 - 0) / (280000 - 0) * 100%);">Median</div>

          <input type="range" id="popFilterMin" min="0" max="280000" step="1000" value="0">
          <input type="range" id="popFilterMax" min="0" max="280000" step="1000" value="280000"></div><span>
          <small>von</small> <span id="popMinValue">0</span>
          <small>bis</small> <span id="popMaxValue">280000</span><small> Tsd. Einwohner</small></span></div>


<div class="filter-group"><label>
<span class="info-icon" data-definition="Bd">ⓘ</span>
Bevölkerungsdichte</label>
<div class="filter-group" style="display:flex; align-items:center; margin-bottom:4px;">
  <input type="checkbox" id="densIncludeNA" checked style="margin-right:6px;">
  <label for="densIncludeNA" style="font-size:0.9em; margin:0;">inkl. N/A</label>
</div>
    <div id="densFilterContainer"><div class="slider-track"></div>
        <div class="slider-range" id="densSliderRange"></div>

<div class="slider-mark" style="left: calc((85 - 0) / (1300 - 0) * 100%);"></div>
<div class="marker-label" style="left: calc((85 - 0) / (1300 - 0) * 100%);">Median</div>

        <input type="range" id="densFilterMin" min="0" max="1300" step="10" value="0">
        <input type="range" id="densFilterMax" min="0" max="1300" step="10" value="1300"></div><span>
        <small>von</small> <span id="densMinValue">0</span>
        <small>bis</small> <span id="densMaxValue">1300</span><small> Einwohner je km²</small></span></div>


</div>
</div>




    </div>
    
     <!-- rechte Spalte: Definitions-Panel -->
      <div id="filterDefinitionPanel"></div>
   
</div>

  <div id="map"></div>


<div id="comparePanel" class="compare-panel" style="display:none;">
  <button id="closeCompare" style="float:right;margin-top:8px; padding:4px 8px;
                     background:#2196F3; color:#fff; border:none; font-size: 0.8rem;
                     border-radius:4px; cursor:pointer;">Schließen</button>
  <h3>Vergleich</h3>
  <table id="compareTable" style="width:100%; border-collapse:collapse;">
    <thead><tr><th>Kriterium</th></tr></thead>
    <tbody></tbody>
  </table>
</div>



<!-- COOKIE-BANNER -->
<div id="cookieBanner">
  <div class="banner-text">
Diese Website verwendet Google Analytics 4-Cookies zur anonymen Nutzungsanalyse. 
Durch „Akzeptieren“ erklärst du dich mit der Speicherung der Cookies einverstanden. 
Mehr Infos und Einstell­möglichkeiten findest du in unseren 
<a href="Cookie-Einstellungen.html">Cookie-Einstellungen</a>.
  </div>
  <div class="banner-actions">
    <button id="acceptCookies">Akzeptieren</button>
    <button id="declineCookies">Ablehnen</button>
  </div>
</div>



  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>


    // ------- Daten & Karte -------

  let countries = [];
  async function loadData() {
    const res = await fetch('/.netlify/functions/countries');
    countries = await res.json();
    updateMap(); // oder was immer deine Initialisierung ist
  }
  document.addEventListener('DOMContentLoaded', loadData);




  document.addEventListener('DOMContentLoaded', function () {
    // 3.1) Alle Titel-Elemente mit Klasse .filter-section-title auswählen
    const titles = document.querySelectorAll('.filter-section-title');

    titles.forEach(titleEl => {
      titleEl.addEventListener('click', function () {
        // 3.2) Parent-Container .filter-section finden
        const parentSection = titleEl.closest('.filter-section');
        if (!parentSection) return;
        
        // 3.3) Klasse .collapsed toggeln
        parentSection.classList.toggle('collapsed');
      });
    });
  });




const initialView = { center: [15, 10], zoom: 3 };

const map = L.map('map').setView(initialView.center, initialView.zoom);

L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  maxZoom: 18
}).addTo(map);

    // Input-Defaults speichern
    const allInputs = Array.from(document.querySelectorAll('#filters input'));
    const defaults = allInputs.map(el => ({ id: el.id, value: el.type === 'checkbox' ? el.checked : el.value, checked: el.type === 'checkbox' ? el.checked : null }));

    // Reset-Handler
    document.getElementById('resetBtn').addEventListener('click', () => {
      defaults.forEach(d => {
        const el = document.getElementById(d.id);
        if (el.type === 'checkbox') el.checked = d.checked;
        else el.value = d.value;
        const span = document.getElementById(el.id.replace('Filter','Value'));
        if (span) span.textContent = el.value;
      });
      if (typeof updateAreaRange === 'function') updateAreaRange(); 
      if (typeof updateForestRange === 'function') updateForestRange(); 
      if (typeof updateTempRange === 'function') updateTempRange(); 
      if (typeof updatePrecipRange === 'function') updatePrecipRange(); 
      if (typeof updateRainyRange === 'function') updateRainyRange(); 
      if (typeof updateSunRange === 'function') updateSunRange(); 
      if (typeof updatePopRange === 'function') updatePopRange(); 
      if (typeof updateDensRange === 'function') updateDensRange(); 
      if (typeof updateHdiRange === 'function') updateHdiRange(); 
      if (typeof updateLifeRange === 'function') updateLifeRange(); 
      if (typeof updateHealthRange === 'function') updateHealthRange(); 
      if (typeof updatePisaRange === 'function') updatePisaRange(); 
      if (typeof updateRiskRange === 'function') updateRiskRange(); 
      if (typeof updateConfRange === 'function') updateConfRange(); 
      if (typeof updateVulnRange === 'function') updateVulnRange(); 
      if (typeof updateHomicideRange === 'function') updateHomicideRange(); 
      if (typeof updateGdpRange === 'function') updateGdpRange(); 
      if (typeof updateTaxRateRange === 'function') updateTaxRateRange();

      map.setView(initialView.center, initialView.zoom);
      updateMap();
    });


map.on('popupopen', function(e) {
  const button = e.popup.getElement().querySelector('.compare-btn');
  if (button) {
    button.addEventListener('click', () => {
      const countryName = button.dataset.country;
      const country = countries.find(c => c.Sn === countryName);
      if (country && !compareList.includes(country)) {
        compareList.push(country);
        renderComparePanel();
      }
    });
  }
});



const compareList = [];

  // Körper: für jedes Attribut eine Zeile
  const meta = {


    L:    { label: 'Land',                         unit: '' },
    H:    { label: 'Hauptstadt',                   unit: '' },
    K:    { label: 'Kontinent',                    unit: '' },
    Sn:   { label: 'Stationsname',                 unit: '' },
    Sh:   { label: 'Stationshöhe',                 unit: 'm' },
    As:   { label: 'Amtssprachen',                 unit: '' },
    Rs:   { label: 'Regionale Sprachen',           unit: '' },

 Lf: { label: 'Landfläche', unit: 'km²' }, 
 Wf: { label: 'Waldfläche', unit: '%' }, 
 Jt: { label: 'Jahresdurchschnittstemperatur', unit: '°C' }, 
 Ns: { label: 'Niederschlag', unit: 'mm/Jahr' }, 
 Rt: { label: 'Regentage', unit: 'd/Jahr' }, 
 Ss: { label: 'Sonnenstunden', unit: 'h/Jahr' }, 
 B: { label: 'Bevölkerung', unit: '1.000 Ew.' }, 
 Bd: { label: 'Bevölkerungsdichte', unit: 'Ew. je km²' }, 
 HDI: { label: 'HDI', unit: '(0-1)' }, 
 Le: { label: 'Lebenserwartung', unit: 'Jahre' }, 
 Gv: { label: 'Gesundheitsversorgung', unit: 'Risiko (0-10)' }, 
 PISA: { label: 'PISA-Studie', unit: 'Punkte' }, 
 N: { label: 'Natur- und Gesundheitskatastrophen', unit: 'Risiko (0-10)' }, 
 Kr: { label: 'Konfliktintensität und -wahrscheinlichkeit', unit: 'Risiko (0-10)' }, 
 V: { label: 'Vulnerabilität', unit: 'Risiko (0-10)' }, 
 M: { label: 'Mordrate', unit: 'je 100.000 Ew.' }, 
 Svt: { label: 'Straßenverkehrstote', unit: 'je 100.000 Ew.' }, 
 BIP: { label: 'BIP', unit: 'USD/Ew.' }, 
 BNE: { label: 'BNE', unit: 'USD/Ew.' }, 
 Wk: { label: 'Wohnungskosten', unit: '%' }, 
 Nk: { label: 'Nahrungsmittelkosten', unit: '%' }, 
 SingleS: { label: 'Steuerlast (ledige)', unit: '%' }, 
 FamilyS: { label: 'Steuerlast (Familien)', unit: '%' }, 
 Sq: { label: 'Steuerquote', unit: '%' }, 
 I: { label: 'Infrastruktur', unit: 'Risiko (0-10)' }, 
 F: { label: 'Forschungs- und Entwicklungsausgaben', unit: '% des BIP' }, 
 CO2: { label: 'CO₂-Emissionen', unit: 't/Ew.' }
  };



const sections = {


  '🌍 Geografie': ['L', 'H', 'K', 'Lf', 'Wf','B', 'Bd'],
  '🗣️ Sprache': ['As', 'Rs'],
  '🌡️ Klima': ['Sn', 'Sh', 'Jt', 'Ns', 'Rt', 'Ss'],
  '⚠️ Risiko und Sicherheit': ['N', 'Kr', 'V', 'M', 'Svt'],
  '💰 Wirtschaft': ['BIP', 'BNE', 'Wk', 'Nk', 'SingleS', 'FamilyS', 'Sq'],
  '📊 Entwicklung': ['HDI', 'Le', 'Gv', 'PISA'],
  '🏗️ Sonstige': ['I', 'F', 'CO2']
};


const keysMitIcon = ['Lf', 'Wf', 'Jt', 'Ns', 'Rt', 'Ss', 'B', 'Bd', 'HDI', 'Le', 'Gv', 'PISA', 'N', 'Kr', 'V', 'M', 'Svt', 'BIP', 'BNE', 'Wk', 'Nk', 'SingleS', 'FamilyS', 'Sq', 'I', 'F', 'CO2'
];


updateMap();



[
'langEn',
'langCh',
'langSp',
'langAr',
'langHi',
'langFr',
'langPo',
'langRu',
'langPe',
'langDe',
'langTr',
'langSw',
'langKo',
'langIt',
'langPol',
'langUk',
'langRum',
'langGr',
'langUn',
'langArm',
'langSe',
'langQu',
'langBu',
'langAl',
'langNi',
'langSl',
'langKr',
'langWe',
'langSlo',
'langNA','langRegional'].forEach(id => {
  document.getElementById(id)
    .addEventListener('change', updateMap);
});



const definitions = {
 
Lf: `
    <h1>Landfläche</h1>
    <h2>Definition</h2>
    <p>Als Landfläche gilt die gesamte Fläche eines Landes. Ausgenommen sind unter Inlandgewässern befindliche Flächen, nationale Ansprüche auf Kontinentalschelf und ausschließliche Wirtschaftszo­nen. In der Regel umfasst die Definition von Inlandgewässern größere Flüsse und Seen.</p>
    <h2>Einheit</h2>
    <p>km²</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Wf: `
    <h1>Waldfläche</h1>
    <h2>Definition</h2>
    <p>Als Waldfläche gilt eine Landfläche von mindestens 0,5 Hektar, die von Bäumen mit einem Beschirmungsgrad von mindestens 10% bedeckt wird und die höher als 5 Meter sind. Sofern diese Schwellenwerte im Wachstumszyklus erreicht werden, gilt die Fläche als bewaldet. Flächen mit Bambus oder Palmenbewuchs, die die Schwellenwerte erfüllen, werden ebenso eingerechnet wie Waldwege, Feuerschneisen oder kleinere Lichtungen. Nicht-städtische Waldflächen (Natur- und Erholungsparks) sowie Pflanzungen, die keiner weiteren landwirtschaftlichen Nutzung zuzurechnen sind, werden einbezogen. Nicht enthalten sind dem entsprechend Flächen, die vorwiegend einer landwirtschaftlichen Nutzung dienen oder sich in städtischen Parks und Gartenanlagen befinden.</p>
    <h2>Einheit</h2>
    <p>% der Landfläche</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Jt: `
    <h1>Jahresdurchschnittstemperatur</h1>
    <h2>Definition</h2>
    <p>Die Jahresdurchschnittstemperatur bezeichnet das arithmetische Mittel aller monatlichen Mitteltemperaturen eines Kalenderjahres an einer Wetterstation. Sie wird in Grad Celsius (°C) angegeben.
Die Werte beruhen auf Beobachtungen nationaler Wetterdienste, insbesondere auf CLIMAT-Meldungen, und können von Jahr zu Jahr je nach Datenverfügbarkeit leicht variieren.</p>
    <h2>Einheit</h2>
    <p>°C</p>
    <h2>Quelle</h2>
    <p>Deutscher Wetterdienst (DWD), Klimadaten weltweit, online abgerufen am 29.03.2025 unter: https://www.dwd.de/DE/leistungen/klimadatenweltweit/klimadatenweltweit.html; Datenbasis: Deutscher Wetterdienst, eigene Auswertung und Darstellung. Lizenz: Creative Commons BY 4.0 (CC BY 4.0).</p>
    <p>Abrufdatum: 29.03.2025</p> `, 
 
Ns: `
    <h1>Niederschlag</h1>
    <h2>Definition</h2>
    <p>Der Jahresniederschlag ist die aufsummierte Niederschlagsmenge eines Jahres an einem bestimmten Ort, gemessen in Millimetern (mm).
Er umfasst alle Formen von Niederschlag (z. B. Regen, Schnee, Hagel), die über das Jahr hinweg mindestens täglich registriert werden.</p>
    <h2>Einheit</h2>
    <p>mm/Jahr</p>
    <h2>Quelle</h2>
    <p>Deutscher Wetterdienst (DWD), Klimadaten weltweit, online abgerufen am 29.03.2025 unter: https://www.dwd.de/DE/leistungen/klimadatenweltweit/klimadatenweltweit.html; Datenbasis: Deutscher Wetterdienst, eigene Auswertung und Darstellung. Lizenz: Creative Commons BY 4.0 (CC BY 4.0).</p>
    <p>Abrufdatum: 29.03.2025</p> `, 
 
Rt: `
    <h1>Regentage</h1>
    <h2>Definition</h2>
    <p>Die Anzahl der Regentage pro Jahr beschreibt, an wie vielen Tagen eines Kalenderjahres an einer Wetterstation mindestens 1 mm Niederschlag gefallen ist.
Dieser Schwellenwert dient international als Standard zur Abgrenzung von Tagen mit signifikantem Niederschlagsereignis.</p>
    <h2>Einheit</h2>
    <p>d/Jahr</p>
    <h2>Quelle</h2>
    <p>Deutscher Wetterdienst (DWD), Klimadaten weltweit, online abgerufen am 29.03.2025 unter: https://www.dwd.de/DE/leistungen/klimadatenweltweit/klimadatenweltweit.html; Datenbasis: Deutscher Wetterdienst, eigene Auswertung und Darstellung. Lizenz: Creative Commons BY 4.0 (CC BY 4.0).</p>
    <p>Abrufdatum: 29.03.2025</p> `, 
 
Ss: `
    <h1>Sonnenstunden</h1>
    <h2>Definition</h2>
    <p>Die Sonnenstunden pro Jahr geben die aufsummierte tatsächliche Sonnenscheindauer in Stunden an, die an einem Ort innerhalb eines Jahres gemessen wurde.
Sie erfassen ausschließlich Zeiträume, in denen die Sonne direkt auf die Erdoberfläche scheint (keine Abschattung durch Wolken).</p>
    <h2>Einheit</h2>
    <p>h/Jahr</p>
    <h2>Quelle</h2>
    <p>Deutscher Wetterdienst (DWD), Klimadaten weltweit, online abgerufen am 29.03.2025 unter: https://www.dwd.de/DE/leistungen/klimadatenweltweit/klimadatenweltweit.html; Datenbasis: Deutscher Wetterdienst, eigene Auswertung und Darstellung. Lizenz: Creative Commons BY 4.0 (CC BY 4.0).</p>
    <p>Abrufdatum: 29.03.2025</p> `, 
 
B: `
    <h1>Bevölkerung</h1>
    <h2>Definition</h2>
    <p>Alle Einwohnerinnen und Einwohner eines Staates unabhängig von Staatsbürgerschaft oder Meldestatus. Ausgenommen sind Geflüchtete, die nicht dauerhaft im Land wohnen.</p>
    <h2>Einheit</h2>
    <p>Tsd. Einwohner</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Bd: `
    <h1>Bevölkerungsdichte</h1>
    <h2>Definition</h2>
    <p>Die Bevölkerungsdichte gibt das Verhältnis zwischen Bevölkerungszahl und Landfläche an.</p>
    <h2>Einheit</h2>
    <p>Einwohner je km²</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
HDI: `
    <h1>HDI</h1>
    <h2>Definition</h2>
    <p>Der Human Development Index (HDI) ist ein zusammenfassendes Maß für den durchschnittlichen Erfolg der menschlichen Entwicklung in zentralen Dimensionen: ein langes und gesundes Leben, Wissen und ein angemessener Lebensstandard. Der HDI wird als geometrisches Mittel der normalisierten Indizes für jede dieser drei Dimensionen berechnet. Die Gesundheitsdimension wird durch die Lebenserwartung bei der Geburt gemessen, die Bildungsdimension durch den Durchschnitt der Schuljahre bei Erwachsenen ab 25 Jahren und die erwarteten Schuljahre für Kinder im schulpflichtigen Alter. Die Dimension des Lebensstandards wird anhand des Bruttonationaleinkommens pro Kopf bewertet. Dabei wird der Logarithmus des Einkommens verwendet, um die abnehmende Bedeutung des Einkommens mit steigendem BNE widerzuspiegeln. Die Ergebnisse der drei HDI-Dimensionen werden dann zu einem Gesamtindex zusammengefasst.</p>
    <h2>Einheit</h2>
    <p>Dimensionsloser Wert zwischen 0 und 1</p>
    <h2>Quelle</h2>
    <p>Human Development Reports. (n.d.). Human Development Index (HDI) and Rankings. United Nations Development Programme (UNDP). Creative Commons Attribution 3.0 IGO License. Abgerufen am 03.04.2025, von https://hdr.undp.org/data-center/human-development-index#/indicies/HDI. (Die gesamte Reihe der Werte und Ranglisten des Human Development Index (HDI) wird jedes Jahr mit der gleichen Methodologie neu berechnet, basierend auf den neuesten (überarbeiteten) Daten und funktionalen Formen. Die HDI-Ranglisten und -Werte im Human Development Report 2014 können daher nicht direkt mit den Indizes aus früheren Berichten verglichen werden. Weitere Informationen finden Sie unter hdr.undp.org.)</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Le: `
    <h1>Lebenserwartung</h1>
    <h2>Definition</h2>
    <p>Zahl der Jahre, die ein neugeborenes Kind unter Annahme der gegenwärtigen Sterblichkeitsverhältnisse im Schnitt leben würde. Dieser Indikator ist in den World Development Indicators enthalten und basiert auf folgenden Primärquellen: United Nations Population Division, nationale Statistikämter, Eurostat, internationale Datenbank der Zensusbehörde der Vereinigten Staaten.</p>
    <h2>Einheit</h2>
    <p>Jahre bei Geburt</p>
    <h2>Quelle</h2>
    <p>Human Development Reports. (n.d.). Human Development Index (HDI) and Rankings. United Nations Development Programme (UNDP). Creative Commons Attribution 3.0 IGO License. Abgerufen am 03.04.2025, von https://hdr.undp.org/data-center/human-development-index#/indicies/HDI. (Die gesamte Reihe der Werte und Ranglisten des Human Development Index (HDI) wird jedes Jahr mit der gleichen Methodologie neu berechnet, basierend auf den neuesten (überarbeiteten) Daten und funktionalen Formen. Die HDI-Ranglisten und -Werte im Human Development Report 2014 können daher nicht direkt mit den Indizes aus früheren Berichten verglichen werden. Weitere Informationen finden Sie unter hdr.undp.org.)</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Gv: `
    <h1>Gesundheitsversorgung</h1>
    <h2>Definition</h2>
    <p>Zugang zur Gesundheitsversorgung:
Der Indikator basiert auf verschiedenen Gesundheitskennzahlen, die zur Bewertung der Gesundheitsversorgung und Risiken innerhalb einer Bevölkerung dienen.
<p>Folgende Kriterien sind berücksichtigt:</p>
<ul>
  <li>Aktuelle Gesundheitsausgaben pro Kopf</li>
  <li>Prozentsatz der Zielpopulation mit Zugang zu drei Dosen Diphtherie-Tetanus-Pertussis</li>
  <li>Prozentsatz der Zielpopulation mit Zugang zur zweiten Dosis des Masern-Impfstoffs</li>
  <li>Prozentsatz der Zielpopulation mit Zugang zur dritten Dosis des Pneumokokken-Konjugat-Impfstoffs</li>
  <li>Ärzte-Dichte</li>
  <li>Müttersterblichkeitsrate</li>
</ul>    <h2>Einheit</h2>
    <p>Risiko als dimensionsloser Wert zwischen 0 (geringes Risiko) und 10 (hohes Risiko)</p>
    <h2>Quelle</h2>
    <p>Inter-Agency Standing Committee and the European Commission, INFORM REPORT 2024: 10 years of INFORM, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/555548, JRC136641.</p>
    <p>Abrufdatum: 30.03.2025</p> `, 
 
PISA: `
    <h1>PISA-Studie</h1>
    <h2>Definition</h2>
    <p>PISA – die Internationale Schulleistungsstudie der OECD – untersucht, was Schüler*innen in den Bereichen Lesekompetenz, Mathematik und Naturwissenschaften wissen und wie gut sie dieses Wissen anwenden können. Die PISA-Studie ist die bisher umfassendste und genaueste internationale Erhebung der Lernstände von Schüler*innen. Ihre Ergebnisse geben Aufschluss über Bildungsqualität und Bildungsgerechtigkeit weltweit und gestatten es Pädagog*innen und politisch Verantwortlichen, aus der Bildungspolitik und -praxis anderer Länder zu lernen. Dies ist der erste von fünf Bänden, in denen die Ergebnisse von PISA 2022, der achten Erhebungsrunde, vorgestellt werden. Band I, Lernstände und Bildungsgerechtigkeit, befasst sich mit den Schülerleistungen in Mathematik, Lesekompetenz und Naturwissenschaften. Zudem richtet er das Augenmerk auf geschlechtsspezifische Leistungsunterschiede und untersucht, welche Zusammenhänge zwischen Leistungen und sozioökonomischem Status sowie Migrationshintergrund bestehen können. Außerdem wird beschrieben, wie sich Bildungsqualität und Bildungsgerechtigkeit im Vergleich zu früheren PISA-Erhebungen entwickelt haben.
<p>Der auf dieser Seite dargestellte Wert ist jeweils der berechnete Durchschnittswert aus den drei Bereichen (Mathematik, Lesekompetenz und Naturwissenschaften).</p></p>
    <h2>Einheit</h2>
    <p>Punkte</p>
    <h2>Quelle</h2>
<p>Quelle: In Anlehnung an OECD (2023), <em>PISA 2022 Results (Volume I): The State of Learning and Equity in Education</em>, PISA, OECD Publishing, Paris, <a href="https://doi.org/10.1787/53f23881-en">https://doi.org/10.1787/53f23881-en</a>. Abrufdatum: 03.04.2025</p>
<p>Eigene Berechnungen oder Anpassungen. </p>`,
 
N: `
    <h1>Natur- und Gesundheitskatastrophen</h1>
    <h2>Definition</h2>
    <p>Der Indikator basiert auf der geschätzten Anzahl von Personen, die jährlich potenziell durch verschiedene Naturgefahren und Krankheitsrisiken betroffen sind. Er kombiniert Informationen zu Gefährdungszonen mit Bevölkerungsdaten, um die durchschnittlich pro Jahr exponierte oder gefährdete Bevölkerung zu bestimmen. Dabei werden sowohl physikalische Ereignisse wie Erdbeben, Überschwemmungen und Wirbelstürme als auch gesundheitliche Risiken wie Epidemien oder Vektoren übertragene Krankheiten berücksichtigt. Ziel ist es, ein ganzheitliches Bild des potenziellen Risikos für die Bevölkerung in einem bestimmten Raum zu liefern.
  <p>Berücksichtigte Ereignisse:</p>
  <ul>
    <li>Erdbeben</li>
    <li>Tsunamis</li>
    <li>Flusshochwasser</li>
    <li>Küstenüberschwemmungen</li>
    <li>Tropische Wirbelstürme</li>
    <li>Dürre</li>
    <li>Epidemien (einschl. Malaria, Zika, Dengue)</li>
  </ul>
    <h2>Einheit</h2>
    <p>Risiko als dimensionsloser Wert zwischen 0 (geringes Risiko) und 10 (hohes Risiko)</p>
    <h2>Quelle</h2>
    <p>Inter-Agency Standing Committee and the European Commission, INFORM REPORT 2024: 10 years of INFORM, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/555548, JRC136641.</p>
    <p>Abrufdatum: 30.03.2025</p> `, 
 
Kr: `
    <h1>Konfliktintensität und -wahrscheinlichkeit</h1>
    <h2>Definition</h2>
    <p>Das Konfliktrisiko basiert auf zwei Werten: aktuelle Konfliktintensität und Wahrscheinlichkeit für einen künftigen Konflikt.

Das UCDP Georeferenced Event Dataset (GED) schätzt die Anzahl der Todesopfer bei einzelnen Ereignissen organisierter Gewalt, die zu einem bestimmten Zeitpunkt und an einem bestimmten Ort stattfinden. Dabei werden drei verschiedene Schätzwerte verwendet: eine „niedrige“ Schätzung, eine „hohe“ Schätzung und eine „beste“ Schätzung (d. h. eine mittlere bzw. realistisch angenommene Schätzung).
INFORM Risk nutzt die „beste“ Schätzung der Gesamtzahl der Todesopfer nach Land und Jahr aus dem UCDP als Maß für die Konfliktintensität.

Der Global Conflict Risk Index (GCRI) schätzt das Risiko innerstaatlicher Konflikte auf Länderebene innerhalb der nächsten vier Jahre.
INFORM Risk verwendet die Wahrscheinlichkeitswerte des GCRI für die Kategorie „jeglicher Konflikt“, die folgende Unterkategorien einschließt:
<li>Staatlich basierter Konflikt</li>
<li>Nicht-staatlicher Konflikt</li>
<li>Einseitige Gewalt</li></p>
    <h2>Einheit</h2>
    <p>Risiko als dimensionsloser Wert zwischen 0 (geringes Risiko) und 10 (hohes Risiko)</p>
    <h2>Quelle</h2>
    <p>Inter-Agency Standing Committee and the European Commission, INFORM REPORT 2024: 10 years of INFORM, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/555548, JRC136641.</p>
    <p>Abrufdatum: 30.03.2025</p> `, 
 
V: `
    <h1>Vulnerabilität</h1>
    <h2>Definition</h2>
    <p>Vulnerabilität beschreibt die Anfälligkeit von Menschen, Haushalten oder Gesellschaften gegenüber externen Schocks (z. B. Konflikten, Naturkatastrophen, Krankheiten) und ihre begrenzte Fähigkeit, mit deren Folgen umzugehen oder sich davon zu erholen. Sie ergibt sich aus einer Kombination von sozialen, wirtschaftlichen, gesundheitlichen und politischen Bedingungen, die die Widerstandskraft eines Landes oder einer Bevölkerungsgruppe beeinflussen.
<p>Folgende Indikatoren tragen zur Bewertung der Vulnerabilität bei:</p>
<ul>
  <li>Human Development Index</li>
  <li>Multidimensionaler Armutsindex</li>
  <li>Gender Inequality Index</li>
  <li>Gini-Koeffizient (Einkommens- oder Konsumungleichheit)</li>
  <li>Öffentliche Hilfe pro Kopf (USD)</li>
  <li>Netto-ODA (% des BNE)</li>
  <li>Rücküberweisungen als Anteil am BIP (%)</li>
  <li>Flüchtlinge und Asylsuchende nach Asylland</li>
  <li>Binnenvertriebene (IDPs)</li>
  <li>Zurückgekehrte Flüchtlinge</li>
  <li>HIV-Prävalenz (15–49 Jahre)</li>
  <li>Neue HIV-Infektionen pro 1.000 nicht infizierte Personen</li>
  <li>Malariainzidenz pro 1.000 gefährdete Personen</li>
  <li>Tuberkuloseinzidenz (pro 100.000)</li>
  <li>Maßnahmenbedarf bei vernachlässigten Tropenkrankheiten (% der Bevölkerung)</li>
  <li>Sterblichkeitsrate unter 5 Jahren (pro 1.000 Lebendgeburten)</li>
  <li>Untergewichtige Kinder unter 5 Jahren (WHO-Standard)</li>
  <li>Anteil der Bevölkerung, die in den letzten 12, 24, 36 Monaten von Naturkatastrophen betroffen war</li>
  <li>Durchschnittliche Nahrungsenergieversorgung (%)</li>
  <li>Unterernährungsrate (% der Bevölkerung)</li>
</ul>
    <h2>Einheit</h2>
    <p>Risiko als dimensionsloser Wert zwischen 0 (geringes Risiko) und 10 (hohes Risiko)</p>
    <h2>Quelle</h2>
    <p>Inter-Agency Standing Committee and the European Commission, INFORM REPORT 2024: 10 years of INFORM, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/555548, JRC136641.</p>
    <p>Abrufdatum: 30.03.2025</p> `, 
 
M: `
    <h1>Mordrate</h1>
    <h2>Definition</h2>
    <p>Die Mordrate ist die Anzahl der Tötungsdelikte pro 100.000 Einwihner pro Jahr. Ein Tötungsdelikt ist die vorsätzliche Tötung einer Person durch eine andere mit der Absicht, den Tod oder eine schwere Verletzung herbeizuführen. Kindstötung ist einzuschließen. Fälle, in denen der Täter lediglich fahrlässig oder leichtsinnig gehandelt hat, sind hier nicht berücksichtigt.</p>
    <h2>Einheit</h2>
    <p>je 100.000 Einwohner/Jahr</p>
    <h2>Quelle</h2>
    <p>Diese Darstellung basiert teilweise auf Daten der Weltgesundheitsorganisation (WHO). Estimates of rates of homicides per 100 000 population. Genf: WHO; 2024. Lizenz: CC BY-NC-SA 3.0 IGO. Diese Adaption wurde nicht von der WHO erstellt. Die WHO übernimmt keine Verantwortung für Inhalt oder Richtigkeit der Adaption. Datenquelle: https://www.who.int/data/gho/data/indicators/indicator-details/GHO/estimates-of-rates-of-homicides-per-100-000-population</p>
    <p>Abrufdatum: 04.04.2025</p> `, 
 
Svt: `
    <h1>Straßenverkehrstote</h1>
    <h2>Definition</h2>
    <p>Personen, die infolge eines Unfalls während der Teilnahme am Straßenverkehr getötet werden.</p>
    <h2>Einheit</h2>
    <p>je 100.000 Einwohner/Jahr</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
BIP: `
    <h1>BIP</h1>
    <h2>Definition</h2>
    <p>Das BIP (Bruttoinlandsprodukt) in jeweiligen Preisen entspricht dem Wert aller im Inland hergestellten Waren und Dienstleistungen ohne Vorleistungen (Wertschöpfung) zzgl. Steuern. Nach der Umrechnung in US$ wird der Wert durch die Gesamtbevölkerung geteilt.</p>
    <h2>Einheit</h2>
    <p>USD/Einwohner</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 

BNE: `
    <h1>BNE</h1>
    <h2>Definition</h2>
    <p>Das BNE (Bruttonationaleinkommen) ist die Summe der von allen Inländern erwirtschafteten Bruttowertschöpfung zuzüglich aller Gütersteuern (abzüglich Gütersubventionen), die nicht bei der Berechnung des Outputs berücksichtigt werden und zuzüglich Nettoeinnahmen aus Primäreinkommen im Ausland (Arbeitnehmerentgelte und Einnahmen aus Grundbesitz). Das Bruttonationaleinkommen in Landeswährung wird von der Weltbank gemäß der Atlas-Methode in US Dollar umgerechnet: Das jeweilige Bruttonationaleinkommen der einzelnen Länder rechnet man dabei mit Hilfe eines Faktors um, der sich am durchschnittlichen Wechselkurs der Landeswährung in den letzten drei Jahren orientiert sowie die Preisentwicklung im Land und im weltwirtschaftlichen Umfeld berücksichtigt. Dadurch wird der Einfluss von Wechselkurschwankungen stark gemildert und die Vergleichbarkeit der Daten verbessert. Die Pro-Kopf-Berechnung erfolgt durch Division mit der Gesamtbevölkerung zur Jahresmitte.</p>
    <h2>Einheit</h2>
    <p>USD/Einwohner</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Wk: `
    <h1>Wohnungskosten</h1>
    <h2>Definition</h2>
    <p>Zur Berechnung des Indikators werden die Ausgaben aller privaten Haushalte für Wohnung, Wasser, Strom, Gas und andere Brennstoffe durch die Gesamtausgaben aller privaten Haushalte für Konsumzwecke geteilt. Grundlage für die Berechnung ist das System der Volkswirtschaftlichen Gesamtrechnung der Vereinten Nationen (SNA) sowie die Klassifikation der Verwendungszwecke des Individualverbrauchs (COICOP). Der vorliegende Indikator repräsentiert den Anteil der COICOP-Abteilung 04 (Wohnung, Wasser, Strom, Gas und andere Brennstoffe) an den Konsumausgaben insgesamt.</p>
    <h2>Einheit</h2>
    <p>% der Kunsumausgaben</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
Nk: `
    <h1>Nahrungsmittelkosten</h1>
    <h2>Definition</h2>
    <p>Zur Berechnung des Indikators werden die Ausgaben der privaten Haushalte für Nahrungsmittel und alkoholfreie Getränke durch die Gesamt Ausgaben der privaten Haushalte für Konsumzwecke geteilt. Grundlage für die Berechnung ist das System der Volkswirtschaftlichen Gesamtrechnung der Vereinten Nationen (SNA) sowie die Klassifikation der Verwendungszwecke des Individualverbrauchs (COICOP). Der vorliegende Indikator repräsentiert den Anteil der COICOP-Abteilung 01 (Nahrungsmittel, alkoholfreie Getränke) an den Konsumausgaben insgesamt.</p>
    <h2>Einheit</h2>
    <p>% der Konsumausgaben</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
SingleS: `
    <h1>Steuerlast (ledige)</h1>
    <h2>Definition</h2>
    <p>Steuerlast einer alleinstehenden Person ohne Kinder mit Durchschnittseinkommen.

Die Steuer- und Abgabenlast beschreibt die Differenz zwischen den Arbeitskosten für den Arbeitgeber und dem Nettolohn, den der Arbeitnehmer tatsächlich erhält. Sie umfasst: Einkommensteuer, Arbeitnehmerbeiträge zur Sozialversicherung, Arbeitgeberbeiträge zur Sozialversicherung. Je größer die Tax Wedge, desto höher ist die gesamtstaatliche Belastung auf Arbeit.</p>
    <h2>Einheit</h2>
    <p>% der Arbeitskosten</p>
    <h2>Quelle</h2>
    <p>OECD (2024), Taxing Wages 2024: Tax and Gender through the Lens of the Second Earner, OECD Publishing, Paris, https://doi.org/10.1787/dbcbac85-en.</p>
    <p>Abrufdatum: 05.04.2025</p> `, 
 
FamilyS: `
    <h1>Steuerlast (Familien)</h1>
    <h2>Definition</h2>
    <p>Steuerlast einer Familie mit <u>einem</u> Einkommen (Durchschnittseinkommen) und zwei Kindern.

Die Steuer- und Abgabenlast beschreibt die Differenz zwischen den Arbeitskosten für den Arbeitgeber und dem Nettolohn, den der Arbeitnehmer tatsächlich erhält. Sie umfasst: Einkommensteuer, Arbeitnehmerbeiträge zur Sozialversicherung, Arbeitgeberbeiträge zur Sozialversicherung. Je größer die Tax Wedge, desto höher ist die gesamtstaatliche Belastung auf Arbeit.</p>
    <h2>Einheit</h2>
    <p>% der Arbeitskosten</p>
    <h2>Quelle</h2>
    <p>OECD (2024), Taxing Wages 2024: Tax and Gender through the Lens of the Second Earner, OECD Publishing, Paris, https://doi.org/10.1787/dbcbac85-en.</p>
    <p>Abrufdatum: 05.04.2025</p> `, 
 
Sq: `
    <h1>Steuerquote</h1>
    <h2>Definition</h2>
    <p>Steuern werden gemäß den Definitionen von IWF und OECD als verpflichtende, nicht gegenleistungsgebundene Zahlungen an den Staat definiert. Sozialabgaben umfassen sowohl verpflichtende als auch freiwillige Beiträge zur Sozialversicherung von Arbeitgebern, Arbeitnehmern und Selbstständigen. Rohstoffsteuern (hauptsächlich im Zusammenhang mit Öl und Bergbau) sind in den Daten nicht systematisch erfasst oder definiert.</p>
    <h2>Einheit</h2>
    <p>% des BIP, inkl. Sozialabgaben</p>
    <h2>Quelle</h2>
    <p>UNU-WIDER Government Revenue Dataset (2023) – with major processing by Our World in Data. “Tax revenues as a share of GDP – UNU-WIDER” [dataset]. UNU-WIDER, “Government Revenue Dataset (GRD) 2023” [original data]. Retrieved April 5, 2025 from https://ourworldindata.org/grapher/tax-revenues-as-a-share-of-gdp-unu-wider</p>
    <p>Abrufdatum: 05.04.2025</p> `, 
 
I: `
    <h1>Infrastruktur</h1>
    <h2>Definition</h2>
    <p>Der Indikator basiert auf verschiedenen Kennzahlen, die die physische Infrastruktur eines Landes messen, insbesondere in Bezug auf Verkehrsinfrastruktur und den Zugang zu grundlegenden sanitären Einrichtungen und Trinkwasser. Folgende Kriterien werden berücksichtigt:
<li>Straßendichte</li>
<li>Zugang zu sanitären Einrichtungen</li>
<li>Zugang zu Trinkwasser</li>
</p>
    <h2>Einheit</h2>
    <p>Risiko als dimensionsloser Wert zwischen 0 (geringes Risiko) und 10 (hohes Risiko)</p>
    <h2>Quelle</h2>
    <p>Inter-Agency Standing Committee and the European Commission, INFORM REPORT 2024: 10 years of INFORM, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/555548, JRC136641.</p>
    <p>Abrufdatum: 30.03.2025</p> `, 
 
F: `
    <h1>Forschungs- und Entwicklungsausgaben</h1>
    <h2>Definition</h2>
    <p>Ausgaben für Forschung und Entwicklung (F&E) umfassen private und öffentliche Ausgaben für schöpferische Tätigkeiten, welche in einer systematischen Art und Weise unternommen werden, um das Wissen zu vertiefen oder neue Kenntnisse zu erlangen. Dies umfasst auch Kenntnisse über den Menschen, die Kultur und die Gesellschaft sowie die Umsetzung des Wissens für neue Anwendungen. Um Forschung und Entwicklung gegenüber verwandten Tätigkeiten abzugrenzen, wird als Hauptkriterium geprüft, ob ein nennenswertes Element von Weiterentwicklung vorhanden ist. Der Begriff Forschung und Entwicklung umfasst drei Aktivitäten: die Grundlagenforschung, die angewandte Forschung und die experimentelle Entwicklung.</p>
    <h2>Einheit</h2>
    <p>% des BIP</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 
 
CO2: `
    <h1>CO₂-Emissionen</h1>
    <h2>Definition</h2>
    <p>Kohlenstoffdioxid-Emissionen aus energetischer Nutzung umfassen den Ausstoß infolge der Verbrennung fossiler Brennstoffe für die Energiegewinnung. Nicht enthalten ist die Verbrennung von Biomasse und Holz sowie der internationale See- und Flugverkehr. Die CO2-Emissionen werden anhand der IEA-Energie-bilanzen, des IPCC-Sektoransatzes und der IPCC Default-Emissionsfaktoren der IPCC-Leitlinien für nationale Treibhausgasinven­tare berechnet. Für die Berechnung der Tonnen CO2 je Einwohner/-in wurde der Sektoransatz für CO2 und die Bevölkerung laut WDI und OECD verwendet.</p>
    <h2>Einheit</h2>
    <p>t/Einwohner</p>
    <h2>Quelle</h2>
    <p>Statistisches Bundesamt (Destatis), Genesis-Online, Abrufdatum 03.04.2025; Datenlizenz by-2-0</p>
    <p>Abrufdatum: 03.04.2025</p> `, 

};

document.querySelectorAll('.info-icon').forEach(icon => {
  icon.addEventListener('click', e => {
    e.stopPropagation(); // Verhindert, dass das Document-Event ausgelöst wird

    const key = icon.dataset.definition;
    const panel = document.getElementById('filterDefinitionPanel');

    panel.innerHTML = definitions[key] || "<p>Keine Definition gefunden.</p>";
    panel.classList.add('visible');

    icon.scrollIntoView({ behavior: 'smooth', block: 'center' });
  });
});


document.addEventListener('click', e => {
  const panel = document.getElementById('filterDefinitionPanel');
  if (!e.target.classList.contains('info-icon')) {
    panel.classList.remove('visible');
  }
});


  function iconClickHandler(e) {
    e.stopPropagation();
    const key = this.dataset.definition;
    const panel = document.getElementById('filterDefinitionPanel');
    panel.innerHTML = definitions[key] || "<p>Keine Definition gefunden.</p>";
    panel.classList.add('visible');
    this.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  // Schließt das Panel, wenn irgendwo anders geklickt wird:
  document.addEventListener('click', e => {
    const panel = document.getElementById('filterDefinitionPanel');
    if (!e.target.classList.contains('info-icon')) {
      panel.classList.remove('visible');
    }
  });

  // — 5. Wenn irgendein Popup geöffnet wird, binde alle Info-Icons darin —
  map.on('popupopen', function(e) {
    // 5.1 Icons anklicken:
    e.popup.getElement()
      .querySelectorAll('.info-icon')
      .forEach(icon => {
        icon.addEventListener('click', iconClickHandler);
      });
    // 5.2 Compare-Button wie gehabt:
    const button = e.popup.getElement().querySelector('.compare-btn');
    if (button) {
      button.addEventListener('click', () => {
        const countryName = button.dataset.country;
        const country = countries.find(c => c.Sn === countryName);
        if (country && !compareList.includes(country)) {
          compareList.push(country);
          renderComparePanel();
        }
      });
    }
  });


const areaIncludeNA = document.getElementById('areaIncludeNA');
document.getElementById('areaIncludeNA').addEventListener('change', updateMap);

const forestIncludeNA = document.getElementById('forestIncludeNA');
document.getElementById('forestIncludeNA').addEventListener('change', updateMap);

const tempIncludeNA = document.getElementById('tempIncludeNA');
document.getElementById('tempIncludeNA').addEventListener('change', updateMap);

const precipIncludeNA = document.getElementById('precipIncludeNA');
document.getElementById('precipIncludeNA').addEventListener('change', updateMap);

const rainyIncludeNA = document.getElementById('rainyIncludeNA');
document.getElementById('rainyIncludeNA').addEventListener('change', updateMap);

const sunIncludeNA = document.getElementById('sunIncludeNA');
document.getElementById('sunIncludeNA').addEventListener('change', updateMap);

const popIncludeNA = document.getElementById('popIncludeNA');
document.getElementById('popIncludeNA').addEventListener('change', updateMap);

const densIncludeNA = document.getElementById('densIncludeNA');
document.getElementById('densIncludeNA').addEventListener('change', updateMap);

const hdiIncludeNA = document.getElementById('hdiIncludeNA');
document.getElementById('hdiIncludeNA').addEventListener('change', updateMap);

const lifeIncludeNA = document.getElementById('lifeIncludeNA');
document.getElementById('lifeIncludeNA').addEventListener('change', updateMap);

const healthIncludeNA = document.getElementById('healthIncludeNA');
document.getElementById('healthIncludeNA').addEventListener('change', updateMap);

const pisaIncludeNA = document.getElementById('pisaIncludeNA');
document.getElementById('pisaIncludeNA').addEventListener('change', updateMap);

const riskIncludeNA = document.getElementById('riskIncludeNA');
document.getElementById('riskIncludeNA').addEventListener('change', updateMap);

const confIncludeNA = document.getElementById('confIncludeNA');
document.getElementById('confIncludeNA').addEventListener('change', updateMap);

const vulnIncludeNA = document.getElementById('vulnIncludeNA');
document.getElementById('vulnIncludeNA').addEventListener('change', updateMap);

const homicideIncludeNA = document.getElementById('homicideIncludeNA');
document.getElementById('homicideIncludeNA').addEventListener('change', updateMap);

const gdpIncludeNA = document.getElementById('gdpIncludeNA');
document.getElementById('gdpIncludeNA').addEventListener('change', updateMap);

const taxRateIncludeNA = document.getElementById('taxRateIncludeNA');
document.getElementById('taxRateIncludeNA').addEventListener('change', updateMap);


// ------- Dual Slider Area-------
    const areaMin = document.getElementById('areaFilterMin');
    const areaMax = document.getElementById('areaFilterMax');
    const areaRange = document.getElementById('areaSliderRange');
    const areaMinValue = document.getElementById('areaMinValue');
    const areaMaxValue = document.getElementById('areaMaxValue');

    function updateAreaRange() {
      let min = parseFloat(areaMin.value), max = parseFloat(areaMax.value);
      if (min > max) [min, max] = [max, min];
      areaMinValue.textContent = min.toFixed(1);
      areaMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(areaMin.min)) / (parseFloat(areaMin.max) - parseFloat(areaMin.min)) * 100;
      const pMax = (max - parseFloat(areaMax.min)) / (parseFloat(areaMax.max) - parseFloat(areaMax.min)) * 100;
      areaRange.style.left  = pMin + '%';
      areaRange.style.width = (pMax - pMin) + '%';

    }

areaMin.addEventListener('input', () => {
  areaIncludeNA.checked = false;
  updateAreaRange();
});
areaMax.addEventListener('input', () => {
  areaIncludeNA.checked = false;
  updateAreaRange();
});
updateAreaRange(); 


// ------- Dual Slider Forest-------
    const forestMin = document.getElementById('forestFilterMin');
    const forestMax = document.getElementById('forestFilterMax');
    const forestRange = document.getElementById('forestSliderRange');
    const forestMinValue = document.getElementById('forestMinValue');
    const forestMaxValue = document.getElementById('forestMaxValue');

    function updateForestRange() {
      let min = parseFloat(forestMin.value), max = parseFloat(forestMax.value);
      if (min > max) [min, max] = [max, min];
      forestMinValue.textContent = min.toFixed(1);
      forestMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(forestMin.min)) / (parseFloat(forestMin.max) - parseFloat(forestMin.min)) * 100;
      const pMax = (max - parseFloat(forestMax.min)) / (parseFloat(forestMax.max) - parseFloat(forestMax.min)) * 100;
      forestRange.style.left  = pMin + '%';
      forestRange.style.width = (pMax - pMin) + '%';

    }

forestMin.addEventListener('input', () => {
  forestIncludeNA.checked = false;
  updateForestRange();
});
forestMax.addEventListener('input', () => {
  forestIncludeNA.checked = false;
  updateForestRange();
});
updateForestRange(); 


    // ------- Dual Slider Temperatur -------
    const tempMin = document.getElementById('tempFilterMin');
    const tempMax = document.getElementById('tempFilterMax');
    const tempRange = document.getElementById('tempSliderRange');
    const tempMinValue = document.getElementById('tempMinValue');
    const tempMaxValue = document.getElementById('tempMaxValue');

    function updateTempRange() {
      let min = parseFloat(tempMin.value), max = parseFloat(tempMax.value);
      if (min > max) [min, max] = [max, min];
      tempMinValue.textContent = min.toFixed(1);
      tempMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(tempMin.min)) / (parseFloat(tempMin.max) - parseFloat(tempMin.min)) * 100;
      const pMax = (max - parseFloat(tempMax.min)) / (parseFloat(tempMax.max) - parseFloat(tempMax.min)) * 100;
      tempRange.style.left  = pMin + '%';
      tempRange.style.width = (pMax - pMin) + '%';


    }

tempMin.addEventListener('input', () => {
  tempIncludeNA.checked = false;
  updateTempRange();
});
tempMax.addEventListener('input', () => {
  tempIncludeNA.checked = false;
  updateTempRange();
});
updateTempRange(); 


    // ------- Dual Slider Niederschlag -------
const precipMin      = document.getElementById('precipFilterMin');
const precipMax      = document.getElementById('precipFilterMax');
const precipRange    = document.getElementById('precipSliderRange');
const precipMinValue = document.getElementById('precipMinValue');
const precipMaxValue = document.getElementById('precipMaxValue');

function updatePrecipRange() {
  let min = parseFloat(precipMin.value),
      max = parseFloat(precipMax.value);

  // immer tauschen, falls der linke Thumb rechts vom rechten ist
  if (min > max) [min, max] = [max, min];

  // Werte-Spans updaten
  precipMinValue.textContent = min;
  precipMaxValue.textContent = max;

  // Prozent‐Positionen berechnen (genau wie beim Temperaturslider):
  const total  = parseFloat(precipMax.max) - parseFloat(precipMin.min);
  const pMin   = (min - parseFloat(precipMin.min)) / total * 100;
  const pMax   = (max - parseFloat(precipMin.min)) / total * 100;

  // Balken setzen
  precipRange.style.left  = pMin + '%';
  precipRange.style.width = (pMax - pMin) + '%';

  // und Karte neu zeichnen
  updateMap();
}

precipMin.addEventListener('input', () => {
  precipIncludeNA.checked = false;
  updatePrecipRange();
});
precipMax.addEventListener('input', () => {
  precipIncludeNA.checked = false;
  updatePrecipRange();
});
updatePrecipRange(); 


    // ------- Dual Slider Regentage -------
    const rainyMin = document.getElementById('rainyFilterMin');
    const rainyMax = document.getElementById('rainyFilterMax');
    const rainyRange = document.getElementById('rainySliderRange');
    const rainyMinValue = document.getElementById('rainyMinValue');
    const rainyMaxValue = document.getElementById('rainyMaxValue');

    function updateRainyRange() {
      let min = parseFloat(rainyMin.value), max = parseFloat(rainyMax.value);
      if (min > max) [min, max] = [max, min];
      rainyMinValue.textContent = min.toFixed(1);
      rainyMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(rainyMin.min)) / (parseFloat(rainyMin.max) - parseFloat(rainyMin.min)) * 100;
      const pMax = (max - parseFloat(rainyMax.min)) / (parseFloat(rainyMax.max) - parseFloat(rainyMax.min)) * 100;
      rainyRange.style.left  = pMin + '%';
      rainyRange.style.width = (pMax - pMin) + '%';

    }

rainyMin.addEventListener('input', () => {
  rainyIncludeNA.checked = false;
  updateRainyRange();
});
rainyMax.addEventListener('input', () => {
  rainyIncludeNA.checked = false;
  updateRainyRange();
});
updateRainyRange(); 


    // ------- Dual Slider Sonnenstunden -------
    const sunMin = document.getElementById('sunFilterMin');
    const sunMax = document.getElementById('sunFilterMax');
    const sunRange = document.getElementById('sunSliderRange');
    const sunMinValue = document.getElementById('sunMinValue');
    const sunMaxValue = document.getElementById('sunMaxValue');

    function updateSunRange() {
      let min = parseFloat(sunMin.value), max = parseFloat(sunMax.value);
      if (min > max) [min, max] = [max, min];
      sunMinValue.textContent = min.toFixed(1);
      sunMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(sunMin.min)) / (parseFloat(sunMin.max) - parseFloat(sunMin.min)) * 100;
      const pMax = (max - parseFloat(sunMax.min)) / (parseFloat(sunMax.max) - parseFloat(sunMax.min)) * 100;
      sunRange.style.left  = pMin + '%';
      sunRange.style.width = (pMax - pMin) + '%';

    }

sunMin.addEventListener('input', () => {
  sunIncludeNA.checked = false;
  updateSunRange();
});
sunMax.addEventListener('input', () => {
  sunIncludeNA.checked = false;
  updateSunRange();
});
updateSunRange(); 


    // ------- Dual Slider Bevölkerung -------
    const popMin = document.getElementById('popFilterMin');
    const popMax = document.getElementById('popFilterMax');
    const popRange = document.getElementById('popSliderRange');
    const popMinValue = document.getElementById('popMinValue');
    const popMaxValue = document.getElementById('popMaxValue');

    function updatePopRange() {
      let min = parseFloat(popMin.value), max = parseFloat(popMax.value);
      if (min > max) [min, max] = [max, min];

const maxPossiblePop = parseFloat(popMax.max);
popMinValue.textContent = min.toFixed(1);
if (max === maxPossiblePop) {
  popMaxValue.textContent = `> ${max.toFixed(1)}`;
} else {
  popMaxValue.textContent = max.toFixed(1);
}

      const pMin = (min - parseFloat(popMin.min)) / (parseFloat(popMin.max) - parseFloat(popMin.min)) * 100;
      const pMax = (max - parseFloat(popMax.min)) / (parseFloat(popMax.max) - parseFloat(popMax.min)) * 100;
      popRange.style.left  = pMin + '%';
      popRange.style.width = (pMax - pMin) + '%';

    }

popMin.addEventListener('input', () => {
  popIncludeNA.checked = false;
  updatePopRange();
});
popMax.addEventListener('input', () => {
  popIncludeNA.checked = false;
  updatePopRange();
});
updatePopRange(); 



// ------- Dual Slider Dens-------
    const densMin = document.getElementById('densFilterMin');
    const densMax = document.getElementById('densFilterMax');
    const densRange = document.getElementById('densSliderRange');
    const densMinValue = document.getElementById('densMinValue');
    const densMaxValue = document.getElementById('densMaxValue');

    function updateDensRange() {
      let min = parseFloat(densMin.value), max = parseFloat(densMax.value);
      if (min > max) [min, max] = [max, min];

const maxPossibleDens = parseFloat(densMax.max);
densMinValue.textContent = min.toFixed(1);
if (max === maxPossibleDens) {
  densMaxValue.textContent = `> ${max.toFixed(1)}`;
} else {
  densMaxValue.textContent = max.toFixed(1);
}

      const pMin = (min - parseFloat(densMin.min)) / (parseFloat(densMin.max) - parseFloat(densMin.min)) * 100;
      const pMax = (max - parseFloat(densMax.min)) / (parseFloat(densMax.max) - parseFloat(densMax.min)) * 100;
      densRange.style.left  = pMin + '%';
      densRange.style.width = (pMax - pMin) + '%';

    }

densMin.addEventListener('input', () => {
  densIncludeNA.checked = false;
  updateDensRange();
});
densMax.addEventListener('input', () => {
  densIncludeNA.checked = false;
  updateDensRange();
});
updateDensRange(); 

// ------- Dual Slider Hdi-------
    const hdiMin = document.getElementById('hdiFilterMin');
    const hdiMax = document.getElementById('hdiFilterMax');
    const hdiRange = document.getElementById('hdiSliderRange');
    const hdiMinValue = document.getElementById('hdiMinValue');
    const hdiMaxValue = document.getElementById('hdiMaxValue');

    function updateHdiRange() {
      let min = parseFloat(hdiMin.value), max = parseFloat(hdiMax.value);
      if (min > max) [min, max] = [max, min];
      hdiMinValue.textContent = min.toFixed(1);
      hdiMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(hdiMin.min)) / (parseFloat(hdiMin.max) - parseFloat(hdiMin.min)) * 100;
      const pMax = (max - parseFloat(hdiMax.min)) / (parseFloat(hdiMax.max) - parseFloat(hdiMax.min)) * 100;
      hdiRange.style.left  = pMin + '%';
      hdiRange.style.width = (pMax - pMin) + '%';

    }

hdiMin.addEventListener('input', () => {
  hdiIncludeNA.checked = false;
  updateHdiRange();
});
hdiMax.addEventListener('input', () => {
  hdiIncludeNA.checked = false;
  updateHdiRange();
});
updateHdiRange(); 


// ------- Dual Slider Life-------
    const lifeMin = document.getElementById('lifeFilterMin');
    const lifeMax = document.getElementById('lifeFilterMax');
    const lifeRange = document.getElementById('lifeSliderRange');
    const lifeMinValue = document.getElementById('lifeMinValue');
    const lifeMaxValue = document.getElementById('lifeMaxValue');

    function updateLifeRange() {
      let min = parseFloat(lifeMin.value), max = parseFloat(lifeMax.value);
      if (min > max) [min, max] = [max, min];
      lifeMinValue.textContent = min.toFixed(1);
      lifeMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(lifeMin.min)) / (parseFloat(lifeMin.max) - parseFloat(lifeMin.min)) * 100;
      const pMax = (max - parseFloat(lifeMax.min)) / (parseFloat(lifeMax.max) - parseFloat(lifeMax.min)) * 100;
      lifeRange.style.left  = pMin + '%';
      lifeRange.style.width = (pMax - pMin) + '%';

    }
 
lifeMin.addEventListener('input', () => {
  lifeIncludeNA.checked = false;
  updateLifeRange();
});
lifeMax.addEventListener('input', () => {
  lifeIncludeNA.checked = false;
  updateLifeRange();
});
updateLifeRange(); 


// ------- Dual Slider Health-------
    const healthMin = document.getElementById('healthFilterMin');
    const healthMax = document.getElementById('healthFilterMax');
    const healthRange = document.getElementById('healthSliderRange');
    const healthMinValue = document.getElementById('healthMinValue');
    const healthMaxValue = document.getElementById('healthMaxValue');

    function updateHealthRange() {
      let min = parseFloat(healthMin.value), max = parseFloat(healthMax.value);
      if (min > max) [min, max] = [max, min];
      healthMinValue.textContent = min.toFixed(1);
      healthMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(healthMin.min)) / (parseFloat(healthMin.max) - parseFloat(healthMin.min)) * 100;
      const pMax = (max - parseFloat(healthMax.min)) / (parseFloat(healthMax.max) - parseFloat(healthMax.min)) * 100;
      healthRange.style.left  = pMin + '%';
      healthRange.style.width = (pMax - pMin) + '%';

    }
 
healthMin.addEventListener('input', () => {
  healthIncludeNA.checked = false;
  updateHealthRange();
});
healthMax.addEventListener('input', () => {
  healthIncludeNA.checked = false;
  updateHealthRange();
});
updateHealthRange(); 


// ------- Dual Slider Pisa-------
    const pisaMin = document.getElementById('pisaFilterMin');
    const pisaMax = document.getElementById('pisaFilterMax');
    const pisaRange = document.getElementById('pisaSliderRange');
    const pisaMinValue = document.getElementById('pisaMinValue');
    const pisaMaxValue = document.getElementById('pisaMaxValue');

    function updatePisaRange() {
      let min = parseFloat(pisaMin.value), max = parseFloat(pisaMax.value);
      if (min > max) [min, max] = [max, min];
      pisaMinValue.textContent = min.toFixed(1);
      pisaMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(pisaMin.min)) / (parseFloat(pisaMin.max) - parseFloat(pisaMin.min)) * 100;
      const pMax = (max - parseFloat(pisaMax.min)) / (parseFloat(pisaMax.max) - parseFloat(pisaMax.min)) * 100;
      pisaRange.style.left  = pMin + '%';
      pisaRange.style.width = (pMax - pMin) + '%';

    }
 
pisaMin.addEventListener('input', () => {
  pisaIncludeNA.checked = false;
  updatePisaRange();
});
pisaMax.addEventListener('input', () => {
  pisaIncludeNA.checked = false;
  updatePisaRange();
});
updatePisaRange(); 


// ------- Dual Slider Risk-------
    const riskMin = document.getElementById('riskFilterMin');
    const riskMax = document.getElementById('riskFilterMax');
    const riskRange = document.getElementById('riskSliderRange');
    const riskMinValue = document.getElementById('riskMinValue');
    const riskMaxValue = document.getElementById('riskMaxValue');

    function updateRiskRange() {
      let min = parseFloat(riskMin.value), max = parseFloat(riskMax.value);
      if (min > max) [min, max] = [max, min];
      riskMinValue.textContent = min.toFixed(1);
      riskMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(riskMin.min)) / (parseFloat(riskMin.max) - parseFloat(riskMin.min)) * 100;
      const pMax = (max - parseFloat(riskMax.min)) / (parseFloat(riskMax.max) - parseFloat(riskMax.min)) * 100;
      riskRange.style.left  = pMin + '%';
      riskRange.style.width = (pMax - pMin) + '%';

    }

riskMin.addEventListener('input', () => {
  riskIncludeNA.checked = false;
  updateRiskRange();
});
riskMax.addEventListener('input', () => {
  riskIncludeNA.checked = false;
  updateRiskRange();
});
updateRiskRange(); 


// ------- Dual Slider Conf-------
    const confMin = document.getElementById('confFilterMin');
    const confMax = document.getElementById('confFilterMax');
    const confRange = document.getElementById('confSliderRange');
    const confMinValue = document.getElementById('confMinValue');
    const confMaxValue = document.getElementById('confMaxValue');

    function updateConfRange() {
      let min = parseFloat(confMin.value), max = parseFloat(confMax.value);
      if (min > max) [min, max] = [max, min];
      confMinValue.textContent = min.toFixed(1);
      confMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(confMin.min)) / (parseFloat(confMin.max) - parseFloat(confMin.min)) * 100;
      const pMax = (max - parseFloat(confMax.min)) / (parseFloat(confMax.max) - parseFloat(confMax.min)) * 100;
      confRange.style.left  = pMin + '%';
      confRange.style.width = (pMax - pMin) + '%';

    }
 
confMin.addEventListener('input', () => {
  confIncludeNA.checked = false;
  updateConfRange();
});
confMax.addEventListener('input', () => {
  confIncludeNA.checked = false;
  updateConfRange();
});
updateConfRange(); 


// ------- Dual Slider Vuln-------
    const vulnMin = document.getElementById('vulnFilterMin');
    const vulnMax = document.getElementById('vulnFilterMax');
    const vulnRange = document.getElementById('vulnSliderRange');
    const vulnMinValue = document.getElementById('vulnMinValue');
    const vulnMaxValue = document.getElementById('vulnMaxValue');

    function updateVulnRange() {
      let min = parseFloat(vulnMin.value), max = parseFloat(vulnMax.value);
      if (min > max) [min, max] = [max, min];
      vulnMinValue.textContent = min.toFixed(1);
      vulnMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(vulnMin.min)) / (parseFloat(vulnMin.max) - parseFloat(vulnMin.min)) * 100;
      const pMax = (max - parseFloat(vulnMax.min)) / (parseFloat(vulnMax.max) - parseFloat(vulnMax.min)) * 100;
      vulnRange.style.left  = pMin + '%';
      vulnRange.style.width = (pMax - pMin) + '%';

    }

vulnMin.addEventListener('input', () => {
  vulnIncludeNA.checked = false;
  updateVulnRange();
});
vulnMax.addEventListener('input', () => {
  vulnIncludeNA.checked = false;
  updateVulnRange();
});
updateVulnRange(); 


// ------- Dual Slider Homicide-------
    const homicideMin = document.getElementById('homicideFilterMin');
    const homicideMax = document.getElementById('homicideFilterMax');
    const homicideRange = document.getElementById('homicideSliderRange');
    const homicideMinValue = document.getElementById('homicideMinValue');
    const homicideMaxValue = document.getElementById('homicideMaxValue');

    function updateHomicideRange() {
      let min = parseFloat(homicideMin.value), max = parseFloat(homicideMax.value);
      if (min > max) [min, max] = [max, min];
      homicideMinValue.textContent = min.toFixed(1);
      homicideMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(homicideMin.min)) / (parseFloat(homicideMin.max) - parseFloat(homicideMin.min)) * 100;
      const pMax = (max - parseFloat(homicideMax.min)) / (parseFloat(homicideMax.max) - parseFloat(homicideMax.min)) * 100;
      homicideRange.style.left  = pMin + '%';
      homicideRange.style.width = (pMax - pMin) + '%';

    }

homicideMin.addEventListener('input', () => {
  homicideIncludeNA.checked = false;
  updateHomicideRange();
});
homicideMax.addEventListener('input', () => {
  homicideIncludeNA.checked = false;
  updateHomicideRange();
});
updateHomicideRange(); 


// ------- Dual Slider Gdp-------
    const gdpMin = document.getElementById('gdpFilterMin');
    const gdpMax = document.getElementById('gdpFilterMax');
    const gdpRange = document.getElementById('gdpSliderRange');
    const gdpMinValue = document.getElementById('gdpMinValue');
    const gdpMaxValue = document.getElementById('gdpMaxValue');

    function updateGdpRange() {
      let min = parseFloat(gdpMin.value), max = parseFloat(gdpMax.value);
      if (min > max) [min, max] = [max, min];
      gdpMinValue.textContent = min.toFixed(1);
      gdpMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(gdpMin.min)) / (parseFloat(gdpMin.max) - parseFloat(gdpMin.min)) * 100;
      const pMax = (max - parseFloat(gdpMax.min)) / (parseFloat(gdpMax.max) - parseFloat(gdpMax.min)) * 100;
      gdpRange.style.left  = pMin + '%';
      gdpRange.style.width = (pMax - pMin) + '%';

    }
 
gdpMin.addEventListener('input', () => {
  gdpIncludeNA.checked = false;
  updateGdpRange();
});
gdpMax.addEventListener('input', () => {
  gdpIncludeNA.checked = false;
  updateGdpRange();
});
updateGdpRange(); 


// ------- Dual Slider TaxRate-------
    const taxRateMin = document.getElementById('taxRateFilterMin');
    const taxRateMax = document.getElementById('taxRateFilterMax');
    const taxRateRange = document.getElementById('taxRateSliderRange');
    const taxRateMinValue = document.getElementById('taxRateMinValue');
    const taxRateMaxValue = document.getElementById('taxRateMaxValue');

    function updateTaxRateRange() {
      let min = parseFloat(taxRateMin.value), max = parseFloat(taxRateMax.value);
      if (min > max) [min, max] = [max, min];
      taxRateMinValue.textContent = min.toFixed(1);
      taxRateMaxValue.textContent = max.toFixed(1);
      const pMin = (min - parseFloat(taxRateMin.min)) / (parseFloat(taxRateMin.max) - parseFloat(taxRateMin.min)) * 100;
      const pMax = (max - parseFloat(taxRateMax.min)) / (parseFloat(taxRateMax.max) - parseFloat(taxRateMax.min)) * 100;
      taxRateRange.style.left  = pMin + '%';
      taxRateRange.style.width = (pMax - pMin) + '%';

    }

taxRateMin.addEventListener('input', () => {
  taxRateIncludeNA.checked = false;
  updateTaxRateRange();
});
taxRateMax.addEventListener('input', () => {
  taxRateIncludeNA.checked = false;
  updateTaxRateRange();
});
updateTaxRateRange(); 


document.querySelectorAll('#filters input[type="range"]').forEach(slider => slider.addEventListener('input', updateMap));

    // ------- Restliche Slider und Werteanzeige -------
//    document.querySelectorAll('#filters input[type=range]').forEach(el => {
//      const span = document.getElementById(el.id.replace('Filter','Value'));
//      el.addEventListener('input', () => {
//        if (span) span.textContent = el.value;
//        updateMap();
//      });
//    });

    // ------- Karte updaten -------
    function updateMap() {

      // Hole alle Filterwerte
      const areaMin    = parseFloat(document.getElementById('areaFilterMin').value);
      const areaMax    = parseFloat(document.getElementById('areaFilterMax').value);
      const forestMin  = parseFloat(document.getElementById('forestFilterMin').value);
      const forestMax  = parseFloat(document.getElementById('forestFilterMax').value);
      const tempMin    = parseFloat(document.getElementById('tempFilterMin').value);
      const tempMax    = parseFloat(document.getElementById('tempFilterMax').value);
      const precipMin  = parseFloat(document.getElementById('precipFilterMin').value);
      const precipMax  = parseFloat(document.getElementById('precipFilterMax').value);
      const rainyMin   = parseFloat(document.getElementById('rainyFilterMin').value);
      const rainyMax   = parseFloat(document.getElementById('rainyFilterMax').value);
      const sunMin     = parseFloat(document.getElementById('sunFilterMin').value);
      const sunMax     = parseFloat(document.getElementById('sunFilterMax').value);
      const popMin     = parseFloat(document.getElementById('popFilterMin').value);
      const popMax     = parseFloat(document.getElementById('popFilterMax').value);

const densMin  = parseFloat(document.getElementById('densFilterMin').value);
const densMax  = parseFloat(document.getElementById('densFilterMax').value);

const hdiMin   = parseFloat(document.getElementById('hdiFilterMin').value);
const hdiMax   = parseFloat(document.getElementById('hdiFilterMax').value);

const lifeMin  = parseFloat(document.getElementById('lifeFilterMin').value);
const lifeMax  = parseFloat(document.getElementById('lifeFilterMax').value);

const healthMin = parseFloat(document.getElementById('healthFilterMin').value);
const healthMax = parseFloat(document.getElementById('healthFilterMax').value);

const pisaMin  = parseFloat(document.getElementById('pisaFilterMin').value);
const pisaMax  = parseFloat(document.getElementById('pisaFilterMax').value);

const riskMin  = parseFloat(document.getElementById('riskFilterMin').value);
const riskMax  = parseFloat(document.getElementById('riskFilterMax').value);

const confMin  = parseFloat(document.getElementById('confFilterMin').value);
const confMax  = parseFloat(document.getElementById('confFilterMax').value);

const vulnMin  = parseFloat(document.getElementById('vulnFilterMin').value);
const vulnMax  = parseFloat(document.getElementById('vulnFilterMax').value);

const homicideMin   = parseFloat(document.getElementById('homicideFilterMin').value);
const homicideMax   = parseFloat(document.getElementById('homicideFilterMax').value);

const gdpMin   = parseFloat(document.getElementById('gdpFilterMin').value);
const gdpMax   = parseFloat(document.getElementById('gdpFilterMax').value);

const taxRateMin  = parseFloat(document.getElementById('taxRateFilterMin').value);
const taxRateMax  = parseFloat(document.getElementById('taxRateFilterMax').value);


const allowAreaNA     = document.getElementById('areaIncludeNA').checked;
const allowForestNA   = document.getElementById('forestIncludeNA').checked;
const allowTempNA     = document.getElementById('tempIncludeNA').checked;
const allowPrecipNA   = document.getElementById('precipIncludeNA').checked;
const allowRainyNA    = document.getElementById('rainyIncludeNA').checked;
const allowSunNA      = document.getElementById('sunIncludeNA').checked;
const allowPopNA      = document.getElementById('popIncludeNA').checked;
const allowDensNA     = document.getElementById('densIncludeNA').checked;
const allowHdiNA      = document.getElementById('hdiIncludeNA').checked;
const allowLifeNA     = document.getElementById('lifeIncludeNA').checked;
const allowHealthNA   = document.getElementById('healthIncludeNA').checked;
const allowPisaNA     = document.getElementById('pisaIncludeNA').checked;
const allowRiskNA     = document.getElementById('riskIncludeNA').checked;
const allowConfNA     = document.getElementById('confIncludeNA').checked;
const allowVulnNA     = document.getElementById('vulnIncludeNA').checked;
const allowHomicideNA      = document.getElementById('homicideIncludeNA').checked;
const allowGdpNA      = document.getElementById('gdpIncludeNA').checked;
const allowTaxRateNA  = document.getElementById('taxRateIncludeNA').checked;




  const filterEn = document.getElementById('langEn').checked;
  const filterCh = document.getElementById('langCh').checked;
  const filterSp = document.getElementById('langSp').checked;
  const filterAr = document.getElementById('langAr').checked;
  const filterHi = document.getElementById('langHi').checked;
  const filterFr = document.getElementById('langFr').checked;
  const filterPo = document.getElementById('langPo').checked;
  const filterRu = document.getElementById('langRu').checked;
  const filterPe = document.getElementById('langPe').checked;
  const filterDe = document.getElementById('langDe').checked;
  const filterTr = document.getElementById('langTr').checked;
  const filterSw = document.getElementById('langSw').checked;
  const filterKo = document.getElementById('langKo').checked;
  const filterIt = document.getElementById('langIt').checked;
  const filterPol = document.getElementById('langPol').checked;
  const filterUk = document.getElementById('langUk').checked;
  const filterRum = document.getElementById('langRum').checked;
  const filterGr = document.getElementById('langGr').checked;
  const filterUn = document.getElementById('langUn').checked;
  const filterArm = document.getElementById('langArm').checked;
  const filterSe = document.getElementById('langSe').checked;
  const filterQu = document.getElementById('langQu').checked;
  const filterBu = document.getElementById('langBu').checked;
  const filterAl = document.getElementById('langAl').checked;
  const filterNi = document.getElementById('langNi').checked;
  const filterSl = document.getElementById('langSl').checked;
  const filterKr = document.getElementById('langKr').checked;
  const filterWe = document.getElementById('langWe').checked;
  const filterSlo = document.getElementById('langSlo').checked;

  const allowLangNA = document.getElementById('langNA').checked;
  const includeRegional = document.getElementById('langRegional').checked;





      // Alte Marker entfernen
      map.eachLayer(l => l instanceof L.CircleMarker && map.removeLayer(l));

      // Neue Marker hinzufügen
      countries.forEach(c => {
        let ok =
//         (c.Lf || 0) >= areaMin   && (c.Lf || 0) <= areaMax   &&
//         (c.Wf || 0) >= forestMin && (c.Wf || 0) <= forestMax &&
//         (c.Jt || 0) >= tempMin   && (c.Jt || 0) <= tempMax   &&
//         (c.Ns || 0) >= precipMin && (c.Ns || 0) <= precipMax &&
//          (c.Rt || 0) >= rainyMin  && (c.Rt || 0) <= rainyMax  &&
//          (c.Ss || 0) >= sunMin    && (c.Ss || 0) <= sunMax    &&
//          (c.B  || 0) >= popMin    && (c.B  || 0) <= popMax    &&
//(c.Bd || 0) >= densMin      && (c.Bd || 0) <= densMax   &&
//(c.HDI|| 0) >= hdiMin       && (c.HDI|| 0) <= hdiMax    &&
//(c.Le || 0) >= lifeMin      && (c.Le || 0) <= lifeMax   &&
//(c.Gv || 0) >= healthMin    && (c.Gv || 0) <= healthMax &&
//(c.PISA||0) >= pisaMin      && (c.PISA||0) <= pisaMax   &&
//(c.N  || 0) >= riskMin      && (c.N  || 0) <= riskMax   &&
//(c.Kr || 0) >= confMin      && (c.Kr || 0) <= confMax   &&
//(c.V  || 0) >= vulnMin      && (c.V  || 0) <= vulnMax   &&
//(c.M  || 0) >= homicideMin  && (c.M  || 0) <= homicideMax &&
//(c.BIP||0)  >= gdpMin       && (c.BIP|| 0) <= gdpMax    &&
(c.Sq || 0) >= taxRateMin   && (c.Sq || 0) <= taxRateMax;


 
const rawArea = c.Lf;
  if (ok) {if (c.Lf == null) {ok = allowAreaNA;} 
  else {ok = (c.Lf >= areaMin && c.Lf <= areaMax);}}

 const rawForest = c.Wf;
  if (ok) {if (c.Wf == null) {ok = allowForestNA;} 
  else {ok = (c.Wf >= forestMin && c.Wf <= forestMax);}}

 const rawTemp = c.Jt;
  if (ok) {if (c.Jt == null) {ok = allowTempNA;} 
  else {ok = (c.Jt >= tempMin && c.Jt <= tempMax);}}

 const rawPrecip = c.Ns;
  if (ok) {if (c.Ns == null) {ok = allowPrecipNA;} 
  else {ok = (c.Ns >= precipMin && c.Ns <= precipMax);}}

 const rawRainy = c.Rt;
  if (ok) {if (c.Rt == null) {ok = allowRainyNA;} 
  else {ok = (c.Rt >= rainyMin && c.Rt <= rainyMax);}}

 const rawSun = c.Ss;
  if (ok) {if (c.Ss == null) {ok = allowSunNA;} 
  else {ok = (c.Ss >= sunMin && c.Ss <= sunMax);}}


  const rawPop = c.B;
if (ok) {
  if (c.B == null) {
    ok = allowPopNA;}
    else {const maxPossiblePop = parseFloat(document.getElementById('popFilterMax').max);
    if (popMax === maxPossiblePop) {ok = (c.B >= popMin);} 
      else {ok = (c.B >= popMin && c.B <= popMax);
    }}}

  const rawDens = c.Bd;
if (ok) {
  if (c.Bd == null) {
    ok = allowDensNA;}
    else {const maxPossibleDens = parseFloat(document.getElementById('densFilterMax').max);
    if (densMax === maxPossibleDens) {ok = (c.Bd >= densMin);} 
      else {ok = (c.Bd >= densMin && c.Bd <= densMax);
    }}}

 const rawHdi = c.HDI;
  if (ok) {if (c.HDI == null) {ok = allowHdiNA;} 
  else {ok = (c.HDI >= hdiMin && c.HDI <= hdiMax);}}

 const rawLife = c.Le;
  if (ok) {if (c.Le == null) {ok = allowLifeNA;} 
  else {ok = (c.Le >= lifeMin && c.Le <= lifeMax);}}

 const rawHealth = c.Gv;
  if (ok) {if (c.Gv == null) {ok = allowHealthNA;} 
  else {ok = (c.Gv >= healthMin && c.Gv <= healthMax);}}

 const rawPisa = c.PISA;
  if (ok) {if (c.PISA == null) {ok = allowPisaNA;} 
  else {ok = (c.PISA >= pisaMin && c.PISA <= pisaMax);}}

 const rawRisk = c.N;
  if (ok) {if (c.N == null) {ok = allowRiskNA;} 
  else {ok = (c.N >= riskMin && c.N <= riskMax);}}

 const rawConf = c.Kr;
  if (ok) {if (c.Kr == null) {ok = allowConfNA;} 
  else {ok = (c.Kr >= confMin && c.Kr <= confMax);}}

 const rawVuln = c.V;
  if (ok) {if (c.V == null) {ok = allowVulnNA;} 
  else {ok = (c.V >= vulnMin && c.V <= vulnMax);}}

 const rawHomicide = c.M;
  if (ok) {if (c.M == null) {ok = allowHomicideNA;} 
  else {ok = (c.M >= homicideMin && c.M <= homicideMax);}}

 const rawGdp = c.BIP;
  if (ok) {if (c.BIP == null) {ok = allowGdpNA;} 
  else {ok = (c.BIP >= gdpMin && c.BIP <= gdpMax);}}

 const rawTaxRate = c.Sq;
  if (ok) {if (c.Sq == null) {ok = allowTaxRateNA;} 
  else {ok = (c.Sq >= taxRateMin && c.Sq <= taxRateMax);}}





    let okLang = true;
    // Falls mindestens eine der Sprachen ausgewählt wurde,
    // muss mindestens eine Bedingung zutreffen:
    if (
filterEn || 
filterCh || 
filterSp || 
filterAr || 
filterHi || 
filterFr || 
filterPo || 
filterRu || 
filterPe || 
filterDe || 
filterTr || 
filterSw || 
filterKo || 
filterIt || 
filterPol || 
filterUk || 
filterRum || 
filterGr || 
filterUn || 
filterArm || 
filterSe || 
filterQu || 
filterBu || 
filterAl || 
filterNi || 
filterSl || 
filterKr || 
filterWe || 
filterSlo 
) {
      okLang = false;

      // Amtssprachen
      const offs = (c.As||'').split(/\s*,\s*/);
      // Regionale Sprachen
      const regs = (c.Rs||'').split(/\s*,\s*/);

      // 1) N/A bei Amtssprachen

      if (filterEn && c.As==null && allowLangNA) okLang = true; 
      if (filterCh && c.As==null && allowLangNA) okLang = true; 
      if (filterSp && c.As==null && allowLangNA) okLang = true; 
      if (filterAr && c.As==null && allowLangNA) okLang = true; 
      if (filterHi && c.As==null && allowLangNA) okLang = true; 
      if (filterFr && c.As==null && allowLangNA) okLang = true; 
      if (filterPo && c.As==null && allowLangNA) okLang = true; 
      if (filterRu && c.As==null && allowLangNA) okLang = true; 
      if (filterPe && c.As==null && allowLangNA) okLang = true; 
      if (filterDe && c.As==null && allowLangNA) okLang = true; 
      if (filterTr && c.As==null && allowLangNA) okLang = true; 
      if (filterSw && c.As==null && allowLangNA) okLang = true; 
      if (filterKo && c.As==null && allowLangNA) okLang = true; 
      if (filterIt && c.As==null && allowLangNA) okLang = true; 
      if (filterPol && c.As==null && allowLangNA) okLang = true; 
      if (filterUk && c.As==null && allowLangNA) okLang = true; 
      if (filterRum && c.As==null && allowLangNA) okLang = true; 
      if (filterGr && c.As==null && allowLangNA) okLang = true; 
      if (filterUn && c.As==null && allowLangNA) okLang = true; 
      if (filterArm && c.As==null && allowLangNA) okLang = true; 
      if (filterSe && c.As==null && allowLangNA) okLang = true; 
      if (filterQu && c.As==null && allowLangNA) okLang = true; 
      if (filterBu && c.As==null && allowLangNA) okLang = true; 
      if (filterAl && c.As==null && allowLangNA) okLang = true; 
      if (filterNi && c.As==null && allowLangNA) okLang = true; 
      if (filterSl && c.As==null && allowLangNA) okLang = true; 
      if (filterKr && c.As==null && allowLangNA) okLang = true; 
      if (filterWe && c.As==null && allowLangNA) okLang = true; 
      if (filterSlo && c.As==null && allowLangNA) okLang = true; 





     if (filterEn) {
        if (offs.includes('Englisch')) okLang = true;
        if (includeRegional && regs.includes('Englisch')) okLang = true;}
     if (filterCh) {
        if (offs.includes('Mandarin')) okLang = true;
        if (includeRegional && regs.includes('Mandarin')) okLang = true;}
     if (filterSp) {
        if (offs.includes('Spanisch')) okLang = true;
        if (includeRegional && regs.includes('Spanisch')) okLang = true;}
     if (filterAr) {
        if (offs.includes('Arabisch')) okLang = true;
        if (includeRegional && regs.includes('Arabisch')) okLang = true;}
     if (filterHi) {
        if (offs.includes('Hindi')) okLang = true;
        if (includeRegional && regs.includes('Hindi')) okLang = true;}
     if (filterFr) {
        if (offs.includes('Französisch')) okLang = true;
        if (includeRegional && regs.includes('Französisch')) okLang = true;}
     if (filterPo) {
        if (offs.includes('Portugiesisch')) okLang = true;
        if (includeRegional && regs.includes('Portugiesisch')) okLang = true;}
     if (filterRu) {
        if (offs.includes('Russisch')) okLang = true;
        if (includeRegional && regs.includes('Russisch')) okLang = true;}
     if (filterPe) {
        if (offs.includes('Persisch')) okLang = true;
        if (includeRegional && regs.includes('Persisch')) okLang = true;}
     if (filterDe) {
        if (offs.includes('Deutsch')) okLang = true;
        if (includeRegional && regs.includes('Deutsch')) okLang = true;}
     if (filterTr) {
        if (offs.includes('Türkisch')) okLang = true;
        if (includeRegional && regs.includes('Türkisch')) okLang = true;}
     if (filterSw) {
        if (offs.includes('Swahili')) okLang = true;
        if (includeRegional && regs.includes('Swahili')) okLang = true;}
     if (filterKo) {
        if (offs.includes('Koreanisch')) okLang = true;
        if (includeRegional && regs.includes('Koreanisch')) okLang = true;}
     if (filterIt) {
        if (offs.includes('Italienisch')) okLang = true;
        if (includeRegional && regs.includes('Italienisch')) okLang = true;}
     if (filterPol) {
        if (offs.includes('Polnisch')) okLang = true;
        if (includeRegional && regs.includes('Polnisch')) okLang = true;}
     if (filterUk) {
        if (offs.includes('Ukrainisch')) okLang = true;
        if (includeRegional && regs.includes('Ukrainisch')) okLang = true;}
     if (filterRum) {
        if (offs.includes('Rumänisch')) okLang = true;
        if (includeRegional && regs.includes('Rumänisch')) okLang = true;}
     if (filterGr) {
        if (offs.includes('Griechisch')) okLang = true;
        if (includeRegional && regs.includes('Griechisch')) okLang = true;}
     if (filterUn) {
        if (offs.includes('Ungarisch')) okLang = true;
        if (includeRegional && regs.includes('Ungarisch')) okLang = true;}
     if (filterArm) {
        if (offs.includes('Armenisch')) okLang = true;
        if (includeRegional && regs.includes('Armenisch')) okLang = true;}
     if (filterSe) {
        if (offs.includes('Serbisch')) okLang = true;
        if (includeRegional && regs.includes('Serbisch')) okLang = true;}
     if (filterQu) {
        if (offs.includes('Quechua')) okLang = true;
        if (includeRegional && regs.includes('Quechua')) okLang = true;}
     if (filterBu) {
        if (offs.includes('Bulgarisch')) okLang = true;
        if (includeRegional && regs.includes('Bulgarisch')) okLang = true;}
     if (filterAl) {
        if (offs.includes('Albanisch')) okLang = true;
        if (includeRegional && regs.includes('Albanisch')) okLang = true;}
     if (filterNi) {
        if (offs.includes('Niederländisch')) okLang = true;
        if (includeRegional && regs.includes('Niederländisch')) okLang = true;}
     if (filterSl) {
        if (offs.includes('Slowakisch')) okLang = true;
        if (includeRegional && regs.includes('Slowakisch')) okLang = true;}
     if (filterKr) {
        if (offs.includes('Kroatisch')) okLang = true;
        if (includeRegional && regs.includes('Kroatisch')) okLang = true;}
     if (filterWe) {
        if (offs.includes('Weißrussisch')) okLang = true;
        if (includeRegional && regs.includes('Weißrussisch')) okLang = true;}
     if (filterSlo) {
        if (offs.includes('Slowenisch')) okLang = true;
        if (includeRegional && regs.includes('Slowenisch')) okLang = true;}

    }

    // Marker nur dann blau, wenn alle Filter UND Sprach-Filter passen:
    const color = (ok && okLang) ? 'blue' : 'gray';





const visualMarker = L.circleMarker([c.Bg, c.Lg], {
  radius: 5, // sichtbare Größe
  fillColor: (ok && okLang) ? 'blue' : 'gray',
  fillOpacity: 0.7,
  stroke: false,
  interactive: false // wichtig: nicht klickbar
}).addTo(map);

// 2. Unsichtbarer großer Marker für Klickbereich
const hitMarker = L.circleMarker([c.Bg, c.Lg], {
  radius: 15, // größerer Klickbereich
  fillOpacity: 0, // komplett transparent
  color: null,    // kein Rand
  stroke: false
}).addTo(map);





// 3. Popup an den "Hit-Marker" binden (dynamisch mit meta/sections)
hitMarker.bindPopup((function() {
  // ① Basis-Container öffnen
  let html = `
    
    </tbody>
      </table>
      <button class="compare-btn" data-country="${c.Sn}"
              style="margin-top:8px; padding:4px 8px;
                     background:#2196F3; color:#fff; border:none;
                     border-radius:4px; cursor:pointer;">
        Vergleichen
      </button>
    </div>

<div style="max-width: 500px; max-height:600px; overflow-y:auto; font-size:0.9em; padding:4px;">
      <h3 style="margin-top:0;">${c.L} | ${c.Sn}</h3>
      <table style="width:100%; border-collapse:collapse;">
       <thead>


  <tr>
    <!-- Neue, erste Spalte: Icon (Überschrift kann leer bleiben) -->
    <th style="text-align:left; padding:4px; border-bottom:1px solid #999;"></th>
    <!-- Zweite Spalte: Kriterium -->
    <th style="text-align:left; padding:4px; border-bottom:1px solid #999;">Kriterium</th>
    <!-- Dritte Spalte: Länder-Wert -->
    <th style="text-align:left; padding:4px; border-bottom:1px solid #999;">${c.L}</th>
    <!-- Vierte Spalte: Einheit -->
    <th style="text-align:left; padding:4px; border-bottom:1px solid #999; min-width:80px;">Einheit</th>
  </tr>
</thead>
        <tbody>
  `;

  // ② Über alle sections‐Einträge iterieren:
  for (const [sectionTitle, keysArray] of Object.entries(sections)) {
    // Abschnitts-Header
    html += `
      <tr class="section-header" 
          style="background-color:#e0e0e0; font-weight:bold;">
        <td colspan="4" style="padding:4px;">${sectionTitle}</td>
      </tr>
    `;

    // ③ Für jeden key in diesem Abschnitt eine Daten-Zeile hinzufügen:
    keysArray.forEach(key => {
      const { label, unit } = meta[key];
      const value = (c[key] !== null && c[key] !== undefined) ? c[key] : 'N/A';

    // Nur für keys, die in keysMitIcon stehen, erscheint das Icon:
      const iconHtml = keysMitIcon.includes(key)
        ? `<span class="info-icon" data-definition="${key}">ⓘ</span>`
        : '';

      html += `
         <tr>
    <!-- 1. Zelle: Icon (entweder <span> oder leer) -->
    <td style="padding:4px; border-bottom:1px solid #ddd; text-align:center;">
      ${iconHtml}
    </td>
          <td style="padding:4px; border-bottom:1px solid #ddd;">
            ${label}
          </td>
          <td style="padding:4px; border-bottom:1px solid #ddd;">${value}</td>
          <td style="padding:4px; border-bottom:1px solid #ddd;">${unit}</td>
        </tr>
      `;
    });
  }



    

  return html;
      })(),

{ minWidth: 500 }

    );

  }); // ← Hier schließt das countries.forEach(c => { … })

}

function addToCompare(options) {
  // options enthält Koordinaten und evtl. eine ID oder Name
  const country = countries.find(c => c.Sn === options.title);
  if (!compareList.includes(country)) {
    compareList.push(country);
  }
  renderComparePanel();
}

function renderComparePanel() {
  const panel = document.getElementById('comparePanel');
  const thead = panel.querySelector('thead tr');
  const tbody = panel.querySelector('tbody');
  // Kopfzeile: Länder-Namen
  thead.innerHTML = '<th>Kriterium</th>' +
    compareList.map(c => `<th>${c.L}</th>`).join('') +  '<th>Einheit</th>';

  tbody.innerHTML = '';


for (const [sectionTitle, sectionKeys] of Object.entries(sections)) {
  // Abschnittsüberschrift einfügen
tbody.innerHTML += `
  <tr class="section-header">
    <td colspan="${2 + compareList.length}">${sectionTitle}</td>
  </tr>
`;

  // Die zugehörigen Datenzeilen einfügen
 sectionKeys.forEach(key => {
  const { label, unit } = meta[key];
  tbody.innerHTML += `
    <tr>
      <td>${label}</td>
      ${compareList.map(c => `<td>${c[key] ?? 'N/A'}</td>`).join('')}
      <td>${unit}</td>
    </tr>
  `;
});
}


  panel.style.display = 'block';
}

// Schließen
document.getElementById('closeCompare').addEventListener('click', () => {
  compareList.length = 0;
  document.getElementById('comparePanel').style.display = 'none';
});





  // 1. Prüfen, ob der Nutzer bereits entschieden hat
  const decision = localStorage.getItem('glbsc_tracking');

  // 2. Wenn er bereits zugestimmt hat, GA jetzt nachladen
  if (decision === 'accepted') {
    injectGAScript();
  }

  // 3. Banner erst anzeigen, wenn noch keine Entscheidung
  window.addEventListener('DOMContentLoaded', () => {
    if (!decision) {
      document.getElementById('cookieBanner').style.display = 'flex';
    }
  });

  // 4. Klick auf "Akzeptieren": Entscheidung speichern, GA nachladen, Banner verstecken
  document.getElementById('acceptCookies').addEventListener('click', () => {
    localStorage.setItem('glbsc_tracking', 'accepted');
    injectGAScript();
    document.getElementById('cookieBanner').style.display = 'none';
  });

  // 5. Klick auf "Ablehnen": Entscheidung speichern, Banner verstecken
  document.getElementById('declineCookies').addEventListener('click', () => {
    localStorage.setItem('glbsc_tracking', 'declined');
    document.getElementById('cookieBanner').style.display = 'none';
  });

  // 6. Optional: Opt-Out-Button in Datenschutzerklärung
  const optOutBtn = document.getElementById('optOutBtn');
  if (optOutBtn) {
    optOutBtn.addEventListener('click', () => {
      localStorage.setItem('glbsc_tracking', 'declined');
      alert('Tracking wurde deaktiviert. Bitte laden Sie die Seite neu, um die Änderungen wirksam werden zu lassen.');
    });
  }

  // Hilfsfunktion: Lade GA-Skript dynamisch und konfiguriere es
  function injectGAScript() {
    // a) GA-Bibliothek nachladen
    const s1 = document.createElement('script');
    s1.src = 'https://www.googletagmanager.com/gtag/js?id=G-BKN9WQTN1F';
    s1.async = true;
    document.head.appendChild(s1);

    // b) Konfiguration starten
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-BKN9WQTN1F', { 'anonymize_ip': true });
  }





  </script>


</body>
</html>